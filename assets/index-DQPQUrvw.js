var e,t,r,n,i,s,o,a,h,l,u,d,c,f,p,g,m,w,A,y,v,V,x,E,b,S=Object.defineProperty,R=(e,t,r)=>((e,t,r)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const M=2.5,T={art:"I am also very interested in art and Design! I like to draw, paint, and sculpt. I also work on most of the UX Design for my projects.","cs-degree":"These are my Degrees. I have a Bachelor's in Biology from the University of Miami, a Bachelor's in Computer Science from Florida International University, <br> and a Master's in Computer Science from Florida International University.","sofa-table":"This is my living room. In my free time, I like to cook, sew, golf, play the violin, go on walks, and hang out with friends. I have a lot of hobbies!",library:"This is my library. I like to read books about medicine, psychology, and computer science. I also ocasionally read books in Spanish and French. ","resu projects":'This is my desk, I currently work as a Software Engineer. If you would like to know more about my work click on these links! \n  <a href="https://linkedin.com/in/barbarellacastillo" target="_blank">LinkedIn</a>\n    <a href="https://github.com/barbare11a" target="_blank">GitHub</a>\n     <a href="./BarbarellaResume.pdf" target="_blank">Resume</a>\n  <br>Contact me at 11barbarella@gmail.com if you have any interesting job opportunities!',"intro-wall":'Welcome to my portfolio! It\'s made with the Kaboom.js library which is a library for making games in JavaScript.\n  Text is rendered with HTML/CSS. So the textbox you\'re currently reading is not rendered within canvas. Check out my source code <a href="https://github.com/barbare11a/portfolio" target="_blank">here</a>. (press enter to close)',wall:'Thanks for checking out my portfolio! use the arrow keys or your mouse to click on the different objects to learn more about me! You can also checkout my 3D portfolio <a href="./3d.html" target="_blank">here</a>. (press enter to close)',ceiling:"I used to climb walls as a child in gymnastics, now I just climb them in my portfolio :)"};var P=Object.defineProperty,k=(e,t)=>P(e,"name",{value:t,configurable:!0}),B=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var r=t.length,n=new Uint8Array(3*(r-("="==t[r-1])-("="==t[r-2]))/4|0),i=0,s=0;i<r;){var o=e[t.charCodeAt(i++)],a=e[t.charCodeAt(i++)],h=e[t.charCodeAt(i++)],l=e[t.charCodeAt(i++)];n[s++]=o<<2|a>>4,n[s++]=a<<4|h>>2,n[s++]=h<<6|l}return n}})();function F(e){return e*Math.PI/180}function I(e){return 180*e/Math.PI}function D(e,t,r){return t>r?D(e,r,t):Math.min(Math.max(e,t),r)}function C(e,t,r){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*r;if(e instanceof L&&t instanceof L)return e.lerp(t,r);if(e instanceof G&&t instanceof G)return e.lerp(t,r);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function U(e,t,r,n,i){return n+(e-t)/(r-t)*(i-n)}function N(e,t,r,n,i){return D(U(e,t,r,n,i),n,i)}k(F,"deg2rad"),k(I,"rad2deg"),k(D,"clamp"),k(C,"lerp"),k(U,"map"),k(N,"mapc");var L=(k(e=class{x=0;y=0;constructor(e=0,t=e){this.x=e,this.y=t}static fromAngle(t){let r=F(t);return new e(Math.cos(r),Math.sin(r))}clone(){return new e(this.x,this.y)}add(...t){let r=O(...t);return new e(this.x+r.x,this.y+r.y)}sub(...t){let r=O(...t);return new e(this.x-r.x,this.y-r.y)}scale(...t){let r=O(...t);return new e(this.x*r.x,this.y*r.y)}dist(...e){let t=O(...e);return this.sub(t).len()}sdist(...e){let t=O(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return 0===t?new e(0):this.scale(1/t)}normal(){return new e(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=O(...e);return I(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=O(...e);return I(Math.atan2(this.cross(t),this.dot(t)))}lerp(t,r){return new e(C(this.x,t.x,r),C(this.y,t.y,r))}slerp(e,t){let r=this.dot(e),n=this.cross(e),i=Math.atan2(n,r);return this.scale(Math.sin((1-t)*i)).add(e.scale(Math.sin(t*i))).scale(1/n)}isZero(){return 0===this.x&&0===this.y}toFixed(t){return new e(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new ce(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},"Vec2"),R(e,"LEFT",new e(-1,0)),R(e,"RIGHT",new e(1,0)),R(e,"UP",new e(0,-1)),R(e,"DOWN",new e(0,1)),e);function O(...e){if(1===e.length){if(e[0]instanceof L)return new L(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new L(...e[0])}return new L(...e)}k(O,"vec2");var G=(t=class{r=255;g=255;b=255;constructor(e,t,r){this.r=D(e,0,255),this.g=D(t,0,255),this.b=D(r,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if("number"==typeof e)return new t(e>>16&255,e>>8&255,255&e);if("string"==typeof e){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new t(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))}throw new Error("Invalid hex color format")}static fromHSL(e,r,n){if(0==r)return new t(255*n,255*n,255*n);let i=k((e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e),"hue2rgb"),s=n<.5?n*(1+r):n+r-n*r,o=2*n-s,a=i(o,s,e+1/3),h=i(o,s,e),l=i(o,s,e-1/3);return new t(Math.round(255*a),Math.round(255*h),Math.round(255*l))}clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,r){return new t(C(this.r,e.r,r),C(this.g,e.g,r),C(this.b,e.b,r))}toHSL(){let e=this.r/255,t=this.g/255,r=this.b/255,n=Math.max(e,t,r),i=Math.min(e,t,r),s=(n+i)/2,o=s,a=s;if(n==i)s=o=0;else{let h=n-i;switch(o=a>.5?h/(2-n-i):h/(n+i),n){case e:s=(t-r)/h+(t<r?6:0);break;case t:s=(r-e)/h+2;break;case r:s=(e-t)/h+4}s/=6}return[s,o,a]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},k(t,"Color"),R(t,"RED",new t(255,0,0)),R(t,"GREEN",new t(0,255,0)),R(t,"BLUE",new t(0,0,255)),R(t,"YELLOW",new t(255,255,0)),R(t,"MAGENTA",new t(255,0,255)),R(t,"CYAN",new t(0,255,255)),R(t,"WHITE",new t(255,255,255)),R(t,"BLACK",new t(0,0,0)),t);function q(...e){if(0===e.length)return new G(255,255,255);if(1===e.length){if(e[0]instanceof G)return e[0].clone();if("string"==typeof e[0])return G.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return G.fromArray(e[0])}return new G(...e)}k(q,"rgb");var H=k((e,t,r)=>G.fromHSL(e,t,r),"hsl2rgb"),K=(k(r=class{x=0;y=0;w=1;h=1;constructor(e,t,r,n){this.x=e,this.y=t,this.w=r,this.h=n}scale(e){return new r(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new L(this.x,this.y)}clone(){return new r(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},"Quad"),r);function Y(e,t,r,n){return new K(e,t,r,n)}k(Y,"quad");var j=(k(n=class{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new n([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new n([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=F(-e);let t=Math.cos(e),r=Math.sin(e);return new n([1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1])}static rotateY(e){e=F(-e);let t=Math.cos(e),r=Math.sin(e);return new n([t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1])}static rotateZ(e){e=F(-e);let t=Math.cos(e),r=Math.sin(e);return new n([t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=F(-e);let t=Math.cos(e),r=Math.sin(e),n=this.m[0],i=this.m[1],s=this.m[4],o=this.m[5];return this.m[0]=n*t+i*r,this.m[1]=-n*r+i*t,this.m[4]=s*t+o*r,this.m[5]=-s*r+o*t,this}mult(e){let t=[];for(let r=0;r<4;r++)for(let n=0;n<4;n++)t[4*r+n]=this.m[0+n]*e.m[4*r+0]+this.m[4+n]*e.m[4*r+1]+this.m[8+n]*e.m[4*r+2]+this.m[12+n]*e.m[4*r+3];return new n(t)}multVec2(e){return new L(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new L(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new L(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new L(e/t,t)}return new L(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return I(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return I(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new L(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new L(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new L(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],i=this.m[9]*this.m[14]-this.m[13]*this.m[10],s=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],h=this.m[6]*this.m[15]-this.m[14]*this.m[7],l=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[4]*this.m[13]-this.m[12]*this.m[5],g=this.m[6]*this.m[11]-this.m[10]*this.m[7],m=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],A=this.m[4]*this.m[11]-this.m[8]*this.m[7],y=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*r+this.m[7]*i,e[4]=-(this.m[4]*t-this.m[6]*s+this.m[7]*o),e[8]=this.m[4]*r-this.m[5]*s+this.m[7]*a,e[12]=-(this.m[4]*i-this.m[5]*o+this.m[6]*a),e[1]=-(this.m[1]*t-this.m[2]*r+this.m[3]*i),e[5]=this.m[0]*t-this.m[2]*s+this.m[3]*o,e[9]=-(this.m[0]*r-this.m[1]*s+this.m[3]*a),e[13]=this.m[0]*i-this.m[1]*o+this.m[2]*a,e[2]=this.m[1]*h-this.m[2]*l+this.m[3]*u,e[6]=-(this.m[0]*h-this.m[2]*d+this.m[3]*c),e[10]=this.m[0]*f-this.m[1]*d+this.m[3]*p,e[14]=-(this.m[0]*u-this.m[1]*c+this.m[2]*p),e[3]=-(this.m[1]*g-this.m[2]*m+this.m[3]*w),e[7]=this.m[0]*g-this.m[2]*A+this.m[3]*y,e[11]=-(this.m[0]*m-this.m[1]*A+this.m[3]*v),e[15]=this.m[0]*w-this.m[1]*y+this.m[2]*v;let V=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let n=0;n<4;n++)for(let t=0;t<4;t++)e[4*n+t]*=1/V;return new n(e)}clone(){return new n([...this.m])}toString(){return this.m.toString()}},"Mat4"),n);function Q(e,t,r,n=e=>-Math.cos(e)){return e+(n(r)+1)/2*(t-e)}k(Q,"wave");var z=2147483648,J=(k(i=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%z,this.seed/z}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new L(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new G(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof L)return this.genVec2(O(0,0),e[0]);if(e[0]instanceof G)return this.genColor(q(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof L&&e[1]instanceof L)return this.genVec2(e[0],e[1]);if(e[0]instanceof G&&e[1]instanceof G)return this.genColor(e[0],e[1])}}},"RNG"),i),X=new J(Date.now());function W(e){return null!=e&&(X.seed=e),X.seed}function Z(...e){return X.genAny(...e)}function _(...e){return Math.floor(Z(...e))}function $(e){return Z()<=e}function ee(e){return e[_(e.length)]}function te(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function re(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let r=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===r)return null;let n=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/r,i=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/r;return n<0||n>1||i<0||i>1?null:n}function ne(e,t){let r=re(e,t);return r?O(e.p1.x+r*(e.p2.x-e.p1.x),e.p1.y+r*(e.p2.y-e.p1.y)):null}function ie(e,t){if(se(e,t.p1)||se(e,t.p2))return!0;let r=e.points();return!!(ne(t,new de(r[0],r[1]))||ne(t,new de(r[1],r[2]))||ne(t,new de(r[2],r[3]))||ne(t,new de(r[3],r[0])))}function se(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function oe(e,t){let r=t.sub(e.p1),n=e.p2.sub(e.p1);if(Math.abs(r.cross(n))>Number.EPSILON)return!1;let i=r.dot(n)/n.dot(n);return i>=0&&i<=1}function ae(e,t){let r=e.p2.sub(e.p1),n=r.dot(r),i=e.p1.sub(t.center),s=2*r.dot(i),o=s*s-4*n*(i.dot(i)-t.radius*t.radius);if(n<=Number.EPSILON||o<0)return!1;if(0==o){let e=-s/(2*n);if(e>=0&&e<=1)return!0}else{let e=(-s+Math.sqrt(o))/(2*n),t=(-s-Math.sqrt(o))/(2*n);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return he(t,e.p1)}function he(e,t){return e.center.sdist(t)<e.radius*e.radius}function le(e,t){let r=t.pts[t.pts.length-1];for(let n of t.pts){if(ae(new de(r,n),e))return!0;r=n}return!!he(e,t.pts[0])||ue(t,e.center)}function ue(e,t){let r=!1,n=e.pts;for(let i=0,s=n.length-1;i<n.length;s=i++)n[i].y>t.y!=n[s].y>t.y&&t.x<(n[s].x-n[i].x)*(t.y-n[i].y)/(n[s].y-n[i].y)+n[i].x&&(r=!r);return r}k(W,"randSeed"),k(Z,"rand"),k(_,"randi"),k($,"chance"),k(ee,"choose"),k(te,"testRectRect"),k(re,"testLineLineT"),k(ne,"testLineLine"),k(ie,"testRectLine"),k(se,"testRectPoint"),k(oe,"testLinePoint"),k(ae,"testLineCircle"),k(he,"testCirclePoint"),k(le,"testCirclePolygon"),k(ue,"testPolygonPoint");var de=(k(s=class{p1;p2;constructor(e,t){this.p1=e.clone(),this.p2=t.clone()}transform(e){return new s(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return ce.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new s(this.p1,this.p2)}},"Line"),s),ce=(k(o=class{pos;width;height;constructor(e,t,r){this.pos=e.clone(),this.width=t,this.height=r}static fromPoints(e,t){return new o(e.clone(),t.x-e.x,t.y-e.y)}center(){return new L(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new ge(this.points().map(t=>e.multVec2(t)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new o(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,r=this.pos.add(this.width,this.height),n=Math.max(t.x-e.x,0,e.x-r.x),i=Math.max(t.y-e.y,0,e.y-r.y);return n*n+i*i}},"Rect"),o),fe=(k(a=class{center;radius;constructor(e,t){this.center=e.clone(),this.radius=t}transform(e){return new pe(this.center,this.radius,this.radius).transform(e)}bbox(){return ce.fromPoints(this.center.sub(O(this.radius)),this.center.add(O(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new a(this.center,this.radius)}},"Circle"),a),pe=(k(h=class{center;radiusX;radiusY;constructor(e,t,r){this.center=e.clone(),this.radiusX=t,this.radiusY=r}transform(e){return new h(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return ce.fromPoints(this.center.sub(O(this.radiusX,this.radiusY)),this.center.add(O(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new h(this.center,this.radiusX,this.radiusY)}},"Ellipse"),h),ge=(k(l=class{pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new l(this.pts.map(t=>e.multVec2(t)))}bbox(){let e=O(Number.MAX_VALUE),t=O(-Number.MAX_VALUE);for(let r of this.pts)e.x=Math.min(e.x,r.x),t.x=Math.max(t.x,r.x),e.y=Math.min(e.y,r.y),t.y=Math.max(t.y,r.y);return ce.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let r=0;r<t;r++){let n=this.pts[r],i=this.pts[(r+1)%t];e+=n.x*i.y*.5,e-=i.x*n.y*.5}return Math.abs(e)}clone(){return new l(this.pts.map(e=>e.clone()))}},"Polygon"),l);function me(e,t){let r=Number.MAX_VALUE,n=O(0);for(let i of[e,t])for(let s=0;s<i.pts.length;s++){let o=i.pts[s],a=i.pts[(s+1)%i.pts.length].sub(o).normal().unit(),h=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let r=e.pts[t].dot(a);h=Math.min(h,r),l=Math.max(l,r)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let r=t.pts[e].dot(a);u=Math.min(u,r),d=Math.max(d,r)}let c=Math.min(l,d)-Math.max(h,u);if(c<0)return null;if(c<Math.abs(r)){let e=d-h,t=u-l;r=Math.abs(e)<Math.abs(t)?e:t,n=a.scale(r)}}return n}k(me,"sat");var we=(u=class extends Map{lastID;constructor(...e){super(...e),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},k(u,"Registry"),u),Ae=(k(d=class{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let t=new d(()=>e.forEach(e=>e.cancel()));return Object.defineProperty(t,"paused",{get:()=>e[0].paused,set:t=>e.forEach(e=>e.paused=t)}),t.paused=!1,t}},"EventController"),d),ye=(k(c=class{handlers=new we;add(e){let t=this.handlers.pushd((...t)=>{r.paused||e(...t)}),r=new Ae(t);return r}addOnce(e){let t=this.add((...r)=>{t.cancel(),e(...r)});return t}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(t=>t(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},"Event"),c),ve=(k(f=class{handlers={};on(e,t){return this.handlers[e]||(this.handlers[e]=new ye),this.handlers[e].add(t)}onOnce(e,t){let r=this.on(e,(...e)=>{r.cancel(),t(...e)});return r}next(e){return new Promise(t=>{this.onOnce(e,(...e)=>t(e[0]))})}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}},"EventHandler"),f);function Ve(e,t){if(e===t)return!0;let r=typeof e,n=typeof t;if(r!==n)return!1;if("object"===r&&"object"===n&&null!==e&&null!==t){if(Array.isArray(e)!==Array.isArray(t))return!1;let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i of r){if(!Ve(e[i],t[i]))return!1}return!0}return!1}function xe(e){let t=window.atob(e),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer}function Ee(e){return xe(e.split(",")[1])}function be(e,t){let r=document.createElement("a");r.href=t,r.download=e,r.click()}function Se(e,t){be(e,"data:text/plain;charset=utf-8,"+t)}function Re(e,t){Se(e,JSON.stringify(t))}function Me(e,t){let r=URL.createObjectURL(t);be(e,r),URL.revokeObjectURL(r)}k(Ve,"deepEq"),k(xe,"base64ToArrayBuffer"),k(Ee,"dataURLToArrayBuffer"),k(be,"download"),k(Se,"downloadText"),k(Re,"downloadJSON"),k(Me,"downloadBlob");var Te=k(e=>e.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),Pe=k(e=>e.split(".").slice(0,-1).join("."),"getFileName");function ke(e,t){return(...r)=>{let n=r.length;return n===e.length?e(...r):n===t.length?t(...r):void 0}}k(ke,"overload2");var Be=(()=>{let e=0;return()=>e++})(),Fe=k(e=>e instanceof Error?e.message:String(e),"getErrorMessage"),Ie=(k(p=class{_items;_compareFn;constructor(e=(e,t)=>e<t){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},"BinaryHeap"),p),De=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Ce(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");let t=[],r=0,n=0;for(;r<e.length;)n+=Ue(r+n,e),Ye(e[r+n])&&n++,qe(e[r+n])&&n++,He(e[r+n])&&n++,je(e[r+n])?n++:(t.push(e.substring(r,r+n)),r+=n,n=0);return t}function Ue(e,t){let r=t[e];if(!Ne(r)||e===t.length-1)return 1;let n=r+t[e+1],i=t.substring(e+2,e+5);return Le(n)&&Le(i)?4:Oe(n)&&Ke(i)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:Ge(i)?4:2}function Ne(e){return e&&ze(e[0].charCodeAt(0),55296,56319)}function Le(e){return ze(Qe(e),127462,127487)}function Oe(e){return ze(Qe(e),127988,127988)}function Ge(e){return ze(Qe(e),127995,127999)}function qe(e){return"string"==typeof e&&ze(e.charCodeAt(0),65024,65039)}function He(e){return"string"==typeof e&&ze(e.charCodeAt(0),8400,8447)}function Ke(e){let t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&ze(t,917504,917631)}function Ye(e){return"string"==typeof e&&De.includes(e.charCodeAt(0))}function je(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function Qe(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function ze(e,t,r){return e>=t&&e<=r}k(Ce,"runes"),k(Ue,"nextUnits"),k(Ne,"isFirstOfSurrogatePair"),k(Le,"isRegionalIndicator"),k(Oe,"isSubdivisionFlag"),k(Ge,"isFitzpatrickModifier"),k(qe,"isVariationSelector"),k(He,"isDiacriticalMark"),k(Ke,"isSupplementarySpecialpurposePlane"),k(Ye,"isGrapheme"),k(je,"isZeroWidthJoiner"),k(Qe,"codePointFromSurrogatePair"),k(ze,"betweenInclusive");var Je={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Xe=(k(g=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},"ButtonState"),g),We=(k(m=class{buttonState=new Xe;stickState=new Map},"GamepadState"),m),Ze=(k(w=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((e,t)=>e+t)/this.dts.length)),this.dts=[])}},"FPSCounter"),w),_e=k(e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new Ze,timeScale:1,skipTime:!1,numFrames:0,mousePos:new L(0),mouseDeltaPos:new L(0),keyState:new Xe,mouseState:new Xe,mergedGamepadState:new We,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new ve};function r(){return t.dt*t.timeScale}function n(){return t.time}function i(){return t.fpsCounter.fps}function s(){return t.numFrames}function o(){return t.canvas.toDataURL()}function a(e){t.canvas.style.cursor=e}function h(){return t.canvas.style.cursor}function l(e){if(e)try{let e=t.canvas.requestPointerLock();e.catch&&e.catch(e=>console.error(e))}catch(r){console.error(r)}else document.exitPointerLock()}function u(){return!!document.pointerLockElement}function d(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function c(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function f(){return document.fullscreenElement||document.webkitFullscreenElement}function p(e=!0){e?d(t.canvas):c()}function g(){return!!f()}function m(){t.stopped=!0;for(let e in de)t.canvas.removeEventListener(e,de[e]);for(let e in ce)document.removeEventListener(e,ce[e]);for(let e in fe)window.removeEventListener(e,fe[e]);Ae.disconnect()}function w(n){null!==t.loopID&&cancelAnimationFrame(t.loopID);let i=0,s=k(o=>{if(t.stopped)return;if("visible"!==document.visibilityState)return void(t.loopID=requestAnimationFrame(s));let a=o/1e3,h=a-t.realTime,l=e.maxFPS?1/e.maxFPS:0;t.realTime=a,i+=h,i>l&&(t.skipTime||(t.dt=i,t.time+=r(),t.fpsCounter.tick(t.dt)),i=0,t.skipTime=!1,t.numFrames++,oe(),n(),ae()),t.loopID=requestAnimationFrame(s)},"frame");s(0)}function A(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function y(){return t.mousePos.clone()}function v(){return t.mouseDeltaPos.clone()}function V(e="left"){return t.mouseState.pressed.has(e)}function x(e="left"){return t.mouseState.down.has(e)}function E(e="left"){return t.mouseState.released.has(e)}function b(){return t.isMouseMoved}function S(e){return void 0===e?t.keyState.pressed.size>0:t.keyState.pressed.has(e)}function R(e){return void 0===e?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(e)}function M(e){return void 0===e?t.keyState.down.size>0:t.keyState.down.has(e)}function T(e){return void 0===e?t.keyState.released.size>0:t.keyState.released.has(e)}function P(e){return void 0===e?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(e)}function B(e){return void 0===e?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(e)}function F(e){return void 0===e?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(e)}function I(e){return t.events.on("resize",e)}k(r,"dt"),k(n,"time"),k(i,"fps"),k(s,"numFrames"),k(o,"screenshot"),k(a,"setCursor"),k(h,"getCursor"),k(l,"setCursorLocked"),k(u,"isCursorLocked"),k(d,"enterFullscreen"),k(c,"exitFullscreen"),k(f,"getFullscreenElement"),k(p,"setFullscreen"),k(g,"isFullscreen"),k(m,"quit"),k(w,"run"),k(A,"isTouchscreen"),k(y,"mousePos"),k(v,"mouseDeltaPos"),k(V,"isMousePressed"),k(x,"isMouseDown"),k(E,"isMouseReleased"),k(b,"isMouseMoved"),k(S,"isKeyPressed"),k(R,"isKeyPressedRepeat"),k(M,"isKeyDown"),k(T,"isKeyReleased"),k(P,"isGamepadButtonPressed"),k(B,"isGamepadButtonDown"),k(F,"isGamepadButtonReleased"),k(I,"onResize");let D=ke(e=>t.events.on("keyDown",e),(e,r)=>t.events.on("keyDown",t=>t===e&&r(e))),C=ke(e=>t.events.on("keyPress",e),(e,r)=>t.events.on("keyPress",t=>t===e&&r(e))),N=ke(e=>t.events.on("keyPressRepeat",e),(e,r)=>t.events.on("keyPressRepeat",t=>t===e&&r(e))),O=ke(e=>t.events.on("keyRelease",e),(e,r)=>t.events.on("keyRelease",t=>t===e&&r(e))),G=ke(e=>t.events.on("mouseDown",t=>e(t)),(e,r)=>t.events.on("mouseDown",t=>t===e&&r(t))),q=ke(e=>t.events.on("mousePress",t=>e(t)),(e,r)=>t.events.on("mousePress",t=>t===e&&r(t))),H=ke(e=>t.events.on("mouseRelease",t=>e(t)),(e,r)=>t.events.on("mouseRelease",t=>t===e&&r(t)));function K(e){return t.events.on("mouseMove",()=>e(y(),v()))}function Y(e){return t.events.on("charInput",e)}function j(e){return t.events.on("touchStart",e)}function Q(e){return t.events.on("touchMove",e)}function z(e){return t.events.on("touchEnd",e)}function J(e){return t.events.on("scroll",e)}function X(e){return t.events.on("hide",e)}function W(e){return t.events.on("show",e)}function Z(e,r){return"function"==typeof e?t.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof r?t.events.on("gamepadButtonDown",t=>t===e&&r(e)):void 0}function _(e,r){return"function"==typeof e?t.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof r?t.events.on("gamepadButtonPress",t=>t===e&&r(e)):void 0}function $(e,r){return"function"==typeof e?t.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof r?t.events.on("gamepadButtonRelease",t=>t===e&&r(e)):void 0}function ee(e,r){return t.events.on("gamepadStick",(t,n)=>t===e&&r(n))}function te(e){t.events.on("gamepadConnect",e)}function re(e){t.events.on("gamepadDisconnect",e)}function ne(e){return t.mergedGamepadState.stickState.get(e)||new L(0)}function ie(){return[...t.charInputted]}function se(){return[...t.gamepads]}function oe(){t.events.trigger("input"),t.keyState.down.forEach(e=>t.events.trigger("keyDown",e)),t.mouseState.down.forEach(e=>t.events.trigger("mouseDown",e)),ue()}function ae(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((e,r)=>{t.mergedGamepadState.stickState.set(r,new L(0))}),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach(e=>{e.buttonState.update(),e.stickState.forEach((t,r)=>{e.stickState.set(r,new L(0))})})}function he(e){let r={index:e.index,isPressed:r=>t.gamepadStates.get(e.index).buttonState.pressed.has(r),isDown:r=>t.gamepadStates.get(e.index).buttonState.down.has(r),isReleased:r=>t.gamepadStates.get(e.index).buttonState.released.has(r),getStick:r=>t.gamepadStates.get(e.index).stickState.get(r)};return t.gamepads.push(r),t.gamepadStates.set(e.index,{buttonState:new Xe,stickState:new Map([["left",new L(0)],["right",new L(0)]])}),r}function le(e){t.gamepads=t.gamepads.filter(t=>t.index!==e.index),t.gamepadStates.delete(e.index)}function ue(){for(let e of navigator.getGamepads())e&&!t.gamepadStates.has(e.index)&&he(e);for(let r of t.gamepads){let n=navigator.getGamepads()[r.index],i=(e.gamepads??{})[n.id]??Je[n.id]??Je.default,s=t.gamepadStates.get(r.index);for(let e=0;e<n.buttons.length;e++)n.buttons[e].pressed?(s.buttonState.down.has(i.buttons[e])||(t.mergedGamepadState.buttonState.press(i.buttons[e]),s.buttonState.press(i.buttons[e]),t.events.trigger("gamepadButtonPress",i.buttons[e])),t.events.trigger("gamepadButtonDown",i.buttons[e])):s.buttonState.down.has(i.buttons[e])&&(t.mergedGamepadState.buttonState.release(i.buttons[e]),s.buttonState.release(i.buttons[e]),t.events.trigger("gamepadButtonRelease",i.buttons[e]));for(let e in i.sticks){let r=i.sticks[e],o=new L(n.axes[r.x],n.axes[r.y]);s.stickState.set(e,o),t.mergedGamepadState.stickState.set(e,o),t.events.trigger("gamepadStick",e,o)}}}k(K,"onMouseMove"),k(Y,"onCharInput"),k(j,"onTouchStart"),k(Q,"onTouchMove"),k(z,"onTouchEnd"),k(J,"onScroll"),k(X,"onHide"),k(W,"onShow"),k(Z,"onGamepadButtonDown"),k(_,"onGamepadButtonPress"),k($,"onGamepadButtonRelease"),k(ee,"onGamepadStick"),k(te,"onGamepadConnect"),k(re,"onGamepadDisconnect"),k(ne,"getGamepadStick"),k(ie,"charInputted"),k(se,"getGamepads"),k(oe,"processInput"),k(ae,"resetInput"),k(he,"registerGamepad"),k(le,"removeGamepad"),k(ue,"processGamepad");let de={},ce={},fe={},pe=e.pixelDensity||window.devicePixelRatio||1;de.mousemove=e=>{let r=new L(e.offsetX,e.offsetY),n=new L(e.movementX,e.movementY);if(g()){let n=t.canvas.width/pe,i=t.canvas.height/pe,s=window.innerWidth,o=window.innerHeight;if(s/o>n/i){let t=o/i,a=(s-n*t)/2;r.x=U(e.offsetX-a,0,n*t,0,n),r.y=U(e.offsetY,0,i*t,0,i)}else{let t=s/n,a=(o-i*t)/2;r.x=U(e.offsetX,0,n*t,0,n),r.y=U(e.offsetY-a,0,i*t,0,i)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=r,t.mouseDeltaPos=n,t.events.trigger("mouseMove")})};let ge=["left","middle","right","back","forward"];de.mousedown=e=>{t.events.onOnce("input",()=>{let r=ge[e.button];r&&(t.mouseState.press(r),t.events.trigger("mousePress",r))})},de.mouseup=e=>{t.events.onOnce("input",()=>{let r=ge[e.button];r&&(t.mouseState.release(r),t.events.trigger("mouseRelease",r))})};let me=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),we={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};de.keydown=e=>{me.has(e.key)&&e.preventDefault(),t.events.onOnce("input",()=>{let r=we[e.key]||e.key.toLowerCase();1===r.length?(t.events.trigger("charInput",r),t.charInputted.push(r)):"space"===r&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),e.repeat?(t.keyState.pressRepeat(r),t.events.trigger("keyPressRepeat",r)):(t.keyState.press(r),t.events.trigger("keyPressRepeat",r),t.events.trigger("keyPress",r))})},de.keyup=e=>{t.events.onOnce("input",()=>{let r=we[e.key]||e.key.toLowerCase();t.keyState.release(r),t.events.trigger("keyRelease",r)})},de.touchstart=r=>{r.preventDefault(),t.events.onOnce("input",()=>{let n=[...r.changedTouches],i=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(n[0].clientX-i.x,n[0].clientY-i.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),n.forEach(e=>{t.events.trigger("touchStart",new L(e.clientX-i.x,e.clientY-i.y),e)})})},de.touchmove=r=>{r.preventDefault(),t.events.onOnce("input",()=>{let n=[...r.changedTouches],i=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(n[0].clientX-i.x,n[0].clientY-i.y),t.events.trigger("mouseMove")),n.forEach(e=>{t.events.trigger("touchMove",new L(e.clientX-i.x,e.clientY-i.y),e)})})},de.touchend=r=>{t.events.onOnce("input",()=>{let n=[...r.changedTouches],i=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(n[0].clientX-i.x,n[0].clientY-i.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),n.forEach(e=>{t.events.trigger("touchEnd",new L(e.clientX-i.x,e.clientY-i.y),e)})})},de.touchcancel=r=>{t.events.onOnce("input",()=>{let n=[...r.changedTouches],i=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new L(n[0].clientX-i.x,n[0].clientY-i.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),n.forEach(e=>{t.events.trigger("touchEnd",new L(e.clientX-i.x,e.clientY-i.y),e)})})},de.wheel=e=>{e.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new L(e.deltaX,e.deltaY))})},de.contextmenu=e=>e.preventDefault(),ce.visibilitychange=()=>{"visible"===document.visibilityState?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},fe.gamepadconnected=e=>{let r=he(e.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",r)})},fe.gamepaddisconnected=e=>{let r=se().filter(t=>t.index===e.gamepad.index)[0];le(e.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",r)})};for(let k in de)t.canvas.addEventListener(k,de[k]);for(let k in ce)document.addEventListener(k,ce[k]);for(let k in fe)window.addEventListener(k,fe[k]);let Ae=new ResizeObserver(e=>{for(let r of e)if(r.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return Ae.observe(t.canvas),{dt:r,time:n,run:w,canvas:t.canvas,fps:i,numFrames:s,quit:m,setFullscreen:p,isFullscreen:g,setCursor:a,screenshot:o,getGamepads:se,getCursor:h,setCursorLocked:l,isCursorLocked:u,isTouchscreen:A,mousePos:y,mouseDeltaPos:v,isKeyDown:M,isKeyPressed:S,isKeyPressedRepeat:R,isKeyReleased:T,isMouseDown:x,isMousePressed:V,isMouseReleased:E,isMouseMoved:b,isGamepadButtonPressed:P,isGamepadButtonDown:B,isGamepadButtonReleased:F,getGamepadStick:ne,charInputted:ie,onResize:I,onKeyDown:D,onKeyPress:C,onKeyPressRepeat:N,onKeyRelease:O,onMouseDown:G,onMousePress:q,onMouseRelease:H,onMouseMove:K,onCharInput:Y,onTouchStart:j,onTouchMove:Q,onTouchEnd:z,onScroll:J,onHide:X,onShow:W,onGamepadButtonDown:Z,onGamepadButtonPress:_,onGamepadButtonRelease:$,onGamepadStick:ee,onGamepadConnect:te,onGamepadDisconnect:re,events:t.events}},"default"),$e=(k(A=class{ctx;src=null;glTex;width;height;constructor(e,t,r,n={}){this.ctx=e;let i=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=t,this.height=r;let s={linear:i.LINEAR,nearest:i.NEAREST}[n.filter??e.opts.texFilter]??i.NEAREST,o={repeat:i.REPEAT,clampToEadge:i.CLAMP_TO_EDGE}[n.wrap]??i.CLAMP_TO_EDGE;this.bind(),t&&r&&i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,o),this.unbind()}static fromImage(e,t,r={}){let n=new A(e,t.width,t.height,r);return n.update(t),n.src=t,n}update(e,t=0,r=0){let n=this.ctx.gl;this.bind(),n.texSubImage2D(n.TEXTURE_2D,0,t,r,n.RGBA,n.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},"Texture"),A),et=(k(y=class{ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,t,r,n={}){this.ctx=e;let i=e.gl;e.onDestroy(()=>this.free()),this.tex=new $e(e,t,r,n),this.glFramebuffer=i.createFramebuffer(),this.glRenderbuffer=i.createRenderbuffer(),this.bind(),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.tex.glTex,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let r=4*this.width,n=new Uint8Array(r);for(let i=0;i<(this.height/2|0);i++){let e=i*r,s=(this.height-i-1)*r;n.set(t.subarray(e,e+r)),t.copyWithin(e,s,s+r),t.set(n,s)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.width,e.height=this.height,t.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},"FrameBuffer"),y),tt=(k(v=class{ctx;glProgram;constructor(e,t,r,n){this.ctx=e,e.onDestroy(()=>this.free());let i=e.gl,s=i.createShader(i.VERTEX_SHADER),o=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(s,t),i.shaderSource(o,r),i.compileShader(s),i.compileShader(o);let a=i.createProgram();if(this.glProgram=a,i.attachShader(a,s),i.attachShader(a,o),n.forEach((e,t)=>i.bindAttribLocation(a,t,e)),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS)){let e=i.getShaderInfoLog(s);if(e)throw new Error("VERTEX SHADER "+e);let t=i.getShaderInfoLog(o);if(t)throw new Error("FRAGMENT SHADER "+t)}i.deleteShader(s),i.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let r in e){let n=e[r],i=t.getUniformLocation(this.glProgram,r);"number"==typeof n?t.uniform1f(i,n):n instanceof j?t.uniformMatrix4fv(i,!1,new Float32Array(n.m)):n instanceof G?t.uniform3f(i,n.r,n.g,n.b):n instanceof L&&t.uniform2f(i,n.x,n.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},"Shader"),v),rt=(k(V=class{ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,t,r,n){let i=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce((e,t)=>e+t.size,0),this.maxVertices=r,this.maxIndices=n,this.glVBuf=i.createBuffer(),e.pushArrayBuffer(this.glVBuf),i.bufferData(i.ARRAY_BUFFER,4*r,i.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=i.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),i.bufferData(i.ELEMENT_ARRAY_BUFFER,4*n,i.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,r,n,i=null,s={}){(e!==this.curPrimitive||i!==this.curTex||n!==this.curShader||!Ve(this.curUniform,s)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let o=this.vqueue.length/this.stride;for(let a of t)this.vqueue.push(a);for(let a of r)this.iqueue.push(a+o);this.curPrimitive=e,this.curShader=n,this.curTex=i,this.curUniform=s}flush(){if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},"BatchRenderer"),V);function nt(e){let t=[],r=k(r=>{t.push(r),e(r)},"push"),n=k(()=>{t.pop(),e(i()??null)},"pop"),i=k(()=>t[t.length-1],"cur");return[r,n,i]}function it(e,t={}){let r=[];function n(e){r.push(e)}function i(){r.forEach(e=>e()),e.getExtension("WEBGL_lose_context").loseContext()}k(n,"onDestroy"),k(i,"destroy");let s=null;function o(t){if(Ve(t,s))return;s=t;let r=t.reduce((e,t)=>e+t.size,0);t.reduce((t,n,i)=>(e.vertexAttribPointer(i,n.size,e.FLOAT,!1,4*r,t),e.enableVertexAttribArray(i),t+4*n.size),0)}k(o,"setVertexFormat");let[a,h]=nt(t=>e.bindTexture(e.TEXTURE_2D,t)),[l,u]=nt(t=>e.bindBuffer(e.ARRAY_BUFFER,t)),[d,c]=nt(t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)),[f,p]=nt(t=>e.bindFramebuffer(e.FRAMEBUFFER,t)),[g,m]=nt(t=>e.bindRenderbuffer(e.RENDERBUFFER,t)),[w,A]=nt(({x:t,y:r,w:n,h:i})=>{e.viewport(t,r,n,i)}),[y,v]=nt(t=>e.useProgram(t));return w({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:n,destroy:i,pushTexture2D:a,popTexture2D:h,pushArrayBuffer:l,popArrayBuffer:u,pushElementArrayBuffer:d,popElementArrayBuffer:c,pushFramebuffer:f,popFramebuffer:p,pushRenderbuffer:g,popRenderbuffer:m,pushViewport:w,popViewport:A,pushProgram:y,popProgram:v,setVertexFormat:o}}k(nt,"genStack"),k(it,"initGfx");var st=(k(x=class{loaded=!1;data=null;error=null;onLoadEvents=new ye;onErrorEvents=new ye;onFinishEvents=new ye;constructor(e){e.then(e=>{this.data=e,this.onLoadEvents.trigger(e)}).catch(e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let t=new x(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},"Asset"),x),ot=(k(E=class{assets=new Map;lastUID=0;add(e,t){let r=e??this.lastUID+++"",n=new st(t);return this.assets.set(r,n),n}addLoaded(e,t){let r=e??this.lastUID+++"",n=st.loaded(t);return this.assets.set(r,n),n}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach(t=>{t.loaded&&e++}),e/this.assets.size}},"AssetBucket"),E);function at(e){return fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t})}function ht(e){return at(e).then(e=>e.json())}function lt(e){return at(e).then(e=>e.text())}function ut(e){return at(e).then(e=>e.arrayBuffer())}function dt(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise((r,n)=>{t.onload=()=>r(t),t.onerror=()=>n(new Error(`Failed to load image from "${e}"`))})}k(at,"fetchURL"),k(ht,"fetchJSON"),k(lt,"fetchText"),k(ut,"fetchArrayBuffer"),k(dt,"loadImg");var ct=2.5949095,ft=2.70158,pt=2*Math.PI/3,gt=2*Math.PI/4.5,mt={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>ft*e*e*e-1.70158*e*e,easeOutBack:e=>1+ft*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-ct)/2:(Math.pow(2*e-2,2)*((ct+1)*(2*e-2)+ct)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*pt),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*pt)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*gt)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*gt)/2+1,easeInBounce:e=>1-mt.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-mt.easeOutBounce(1-2*e))/2:(1+mt.easeOutBounce(2*e-1))/2},wt=mt,At=(k(b=class{textures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,t,r){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=r,this.textures=[$e.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push($e.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],r=new L(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,r.x,r.y):this.c2d.drawImage(e,r.x,r.y),t.update(this.canvas),[t,new K(r.x/this.canvas.width,r.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},"TexPacker"),b),yt=B("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),vt=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Vt="topleft",xt="monospace",Et=256,bt="linear",St=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Rt=8192*St.reduce((e,t)=>e+t.size,0),Mt="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Tt="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",Pt="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",kt="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Bt=new Set(["id","require"]),Ft=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function It(e){switch(e){case"topleft":return new L(-1,-1);case"top":return new L(0,-1);case"topright":return new L(1,-1);case"left":return new L(-1,0);case"center":return new L(0,0);case"right":return new L(1,0);case"botleft":return new L(-1,1);case"bot":return new L(0,1);case"botright":return new L(1,1);default:return e}}function Dt(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Ct(e){return e.createBuffer(1,1,44100)}k(It,"anchorPt"),k(Dt,"alignPt"),k(Ct,"createEmptyAudioBuffer");const Ut=k((e={})=>{let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let r=e.canvas??(()=>{let e=document.createElement("canvas");return t.appendChild(e),e})(),n=e.scale??1,i=e.width&&e.height&&!e.stretch&&!e.letterbox;i?(r.width=e.width*n,r.height=e.height*n):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight);let s=["outline: none","cursor: default"];if(i){let e=r.width,t=r.height;s.push(`width: ${e}px`),s.push(`height: ${t}px`)}else s.push("width: 100%"),s.push("height: 100%");e.crisp&&(s.push("image-rendering: pixelated"),s.push("image-rendering: crisp-edges")),r.style.cssText=s.join(";");let o=e.pixelDensity||window.devicePixelRatio;r.width*=o,r.height*=o,r.tabIndex=0;let a=document.createElement("canvas");a.width=Et,a.height=Et;let h=a.getContext("2d",{willReadFrequently:!0}),l=_e({canvas:r,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),u=[],d=l.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),c=it(d,{texFilter:e.texFilter}),f=(()=>{let t=Ze(Pt,kt),r=$e.fromImage(c,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),i=e.width&&e.height?new et(c,e.width*o*n,e.height*o*n):new et(c,d.drawingBufferWidth,d.drawingBufferHeight),s=null,a=1;e.background&&(s=q(e.background),a=Array.isArray(e.background)?e.background[3]:1,d.clearColor(s.r/255,s.g/255,s.b/255,a??1)),d.enable(d.BLEND),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);let h=new rt(c,St,Rt,12288),l=$e.fromImage(c,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:t,defTex:r,frameBuffer:i,postShader:null,postShaderUniform:null,renderer:h,transform:new j,transformStack:[],bgTex:l,bgColor:s,bgAlpha:a,width:e.width??d.drawingBufferWidth/o/n,height:e.height??d.drawingBufferHeight/o/n,viewport:{x:0,y:0,width:d.drawingBufferWidth,height:d.drawingBufferHeight},fixed:!1}})();const p=class e{tex;frames=[new K(0,0,1,1)];anims={};slice9=null;constructor(e,t,r={},n=null){this.tex=e,t&&(this.frames=t),this.anims=r,this.slice9=n}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,r={}){return"string"==typeof t?e.fromURL(t,r):Promise.resolve(e.fromImage(t,r))}static fromImage(t,r={}){let[n,i]=y.packer.add(t),s=r.frames?r.frames.map(e=>new K(i.x+e.x*i.w,i.y+e.y*i.h,e.w*i.w,e.h*i.h)):B(r.sliceX||1,r.sliceY||1,i.x,i.y,i.w,i.h);return new e(n,s,r.anims,r.slice9)}static fromURL(t,r={}){return dt(t).then(t=>e.fromImage(t,r))}};k(p,"SpriteData");let g=p;const m=class e{buf;constructor(e){this.buf=e}static fromArrayBuffer(t){return new Promise((e,r)=>A.ctx.decodeAudioData(t,e,r)).then(t=>new e(t))}static fromURL(t){return Te(t)?e.fromArrayBuffer(Ee(t)):ut(t).then(t=>e.fromArrayBuffer(t))}};k(m,"SoundData");let w=m,A=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let r=new w(Ct(e));return e.decodeAudioData(yt.buffer.slice(0)).then(e=>{r.buf=e}).catch(e=>{console.error("Failed to load burp: ",e)}),{ctx:e,masterNode:t,burpSnd:r}})(),y={urlPrefix:"",sprites:new ot,fonts:new ot,bitmapFonts:new ot,sounds:new ot,shaders:new ot,custom:new ot,packer:new At(c,2048,2048),loaded:!1};function v(e){return"string"!=typeof e||Te(e)?e:y.urlPrefix+e}k(v,"fixURL");let V={events:new ve,objEvents:new ve,root:Rr([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new L(1),angle:0,shake:0,transform:new j}};function x(e){return y.custom.add(null,e)}function E(){let e=[y.sprites,y.sounds,y.shaders,y.fonts,y.bitmapFonts,y.custom];return e.reduce((e,t)=>e+t.progress(),0)/e.length}function b(e){return void 0!==e&&(y.urlPrefix=e),y.urlPrefix}function S(e,t){return y.custom.add(e,ht(t))}V.root.use(cn()),k(x,"load"),k(E,"loadProgress"),k(b,"loadRoot"),k(S,"loadJSON");const R=class{fontface;filter=bt;outline=null;size=64;constructor(e,t={}){if(this.fontface=e,this.filter=t.filter??bt,this.size=t.size??64,this.size>Et)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:q(0,0,0)},"number"==typeof t.outline?this.outline.width=t.outline:"object"==typeof t.outline&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}};k(R,"FontData");let M=R;function T(e,t,r={}){let n=new FontFace(e,"string"==typeof t?`url(${t})`:t);return document.fonts.add(n),y.fonts.add(e,n.load().catch(e=>{throw new Error(`Failed to load font from "${t}": ${e}`)}).then(e=>new M(e,r)))}function P(e,t,r,n,i={}){return y.bitmapFonts.add(e,dt(t).then(e=>nt($e.fromImage(c,e,i),r,n,i.chars??vt)))}function B(e=1,t=1,r=0,n=0,i=1,s=1){let o=[],a=i/e,h=s/t;for(let l=0;l<t;l++)for(let t=0;t<e;t++)o.push(new K(r+t*a,n+l*h,a,h));return o}function z(e,t){return e=v(e),x("string"==typeof t?new Promise((r,n)=>{ht(t).then(t=>{z(e,t).then(r).catch(n)})}):g.from(e).then(e=>{let r={};for(let n in t){let i=t[n],s=e.frames[0],o=2048*s.w,a=2048*s.h,h=i.frames?i.frames.map(e=>new K(s.x+(i.x+e.x)/o*s.w,s.y+(i.y+e.y)/a*s.h,e.w/o*s.w,e.h/a*s.h)):B(i.sliceX||1,i.sliceY||1,s.x+i.x/o*s.w,s.y+i.y/a*s.h,i.width/o*s.w,i.height/a*s.h),l=new g(e.tex,h,i.anims);y.sprites.addLoaded(n,l),r[n]=l}return r}))}function X(e,t={}){let r=document.createElement("canvas"),n=e[0].width,i=e[0].height;r.width=n*e.length,r.height=i;let s=r.getContext("2d");e.forEach((e,t)=>{e instanceof ImageData?s.putImageData(e,t*n,0):s.drawImage(e,t*n,0)});let o=s.getImageData(0,0,e.length*n,i);return g.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function re(e,t,r={sliceX:1,sliceY:1,anims:{}}){return t=v(t),Array.isArray(t)?t.some(e=>"string"==typeof e)?y.sprites.add(e,Promise.all(t.map(e=>"string"==typeof e?dt(e):Promise.resolve(e))).then(e=>X(e,r))):y.sprites.addLoaded(e,X(t,r)):"string"==typeof t?y.sprites.add(e,g.from(t,r)):y.sprites.addLoaded(e,g.fromImage(t,r))}function he(e,t){return t=v(t),y.sprites.add(e,new Promise(async e=>{let r="string"==typeof t?await ht(t):t,n=await Promise.all(r.frames.map(dt)),i=document.createElement("canvas");i.width=r.width,i.height=r.height*r.frames.length;let s=i.getContext("2d");n.forEach((e,t)=>{s.drawImage(e,0,t*r.height)}),e(await re(null,i,{sliceY:r.frames.length,anims:r.anims}))}))}function pe(e,t,r){t=v(t),r=v(r),"string"==typeof t&&!r&&(r=Pe(t)+".json");let n="string"==typeof r?ht(r):Promise.resolve(r);return y.sprites.add(e,n.then(e=>{let r=e.meta.size,n=e.frames.map(e=>new K(e.frame.x/r.w,e.frame.y/r.h,e.frame.w/r.w,e.frame.h/r.h)),i={};for(let t of e.meta.frameTags)t.from===t.to?i[t.name]=t.from:i[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return g.from(t,{frames:n,anims:i})}))}function Ve(e,t,r){return y.shaders.addLoaded(e,Ze(t,r))}function xe(e,t,r){t=v(t),r=v(r);let n=k(e=>e?lt(e):Promise.resolve(null),"resolveUrl"),i=Promise.all([n(t),n(r)]).then(([e,t])=>Ze(e,t));return y.shaders.add(e,i)}function De(e,t){return t=v(t),y.sounds.add(e,"string"==typeof t?w.fromURL(t):w.fromArrayBuffer(t))}function Ue(e="bean"){return re(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function Ne(e){return y.sprites.get(e)}function Le(e){return y.sounds.get(e)}function Oe(e){return y.fonts.get(e)}function Ge(e){return y.bitmapFonts.get(e)}function qe(e){return y.shaders.get(e)}function He(e){return y.custom.get(e)}function Ke(e){if("string"==typeof e){let t=Ne(e);if(t)return t;if(E()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof g)return st.loaded(e);if(e instanceof st)return e;throw new Error(`Invalid sprite: ${e}`)}function Ye(e){if("string"==typeof e){let t=Le(e);if(t)return t;if(E()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof w)return st.loaded(e);if(e instanceof st)return e;throw new Error(`Invalid sound: ${e}`)}function je(e){if(!e)return f.defShader;if("string"==typeof e){let t=qe(e);if(t)return t.data??t;if(E()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof st&&e.data?e.data:e}function Qe(t){if(!t)return Qe(e.font??"monospace");if("string"==typeof t){let e=Ge(t),r=Oe(t);if(e)return e.data??e;if(r)return r.data??r;if(document.fonts.check(`64px ${t}`))return t;if(E()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof st&&t.data?t.data:t}function ze(e){return void 0!==e&&(A.masterNode.gain.value=e),A.masterNode.gain.value}function Je(e,t={}){let r=A.ctx,n=t.paused??!1,i=r.createBufferSource(),s=new ye,o=r.createGain(),a=t.seek??0,h=0,l=0,u=!1;i.loop=!!t.loop,i.detune.value=t.detune??0,i.playbackRate.value=t.speed??1,i.connect(o),i.onended=()=>{f()>=i.buffer?.duration&&s.trigger()},o.connect(A.masterNode),o.gain.value=t.volume??1;let d=k(e=>{i.buffer=e.buf,n||(h=r.currentTime,i.start(0,a),u=!0)},"start"),c=Ye(e);c instanceof st&&c.onLoad(d);let f=k(()=>{if(!i.buffer)return 0;let e=n?l-h:r.currentTime-h,t=i.buffer.duration;return i.loop?e%t:Math.min(e,t)},"getTime"),p=k(e=>{let t=r.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(o),t},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(n!==e)if(n=e,e)u&&(i.stop(),u=!1),l=r.currentTime;else{i=p(i);let e=l-h;i.start(0,e),u=!0,h=r.currentTime-e,l=0}},get paused(){return n},play(e=0){this.seek(e),this.paused=!1},seek(e){i.buffer?.duration&&(e>i.buffer.duration||(n?(i=p(i),h=l-e):(i.stop(),i=p(i),h=r.currentTime-e,i.start(0,e),u=!0,l=0)))},set speed(e){i.playbackRate.value=e},get speed(){return i.playbackRate.value},set detune(e){i.detune.value=e},get detune(){return i.detune.value},set volume(e){o.gain.value=Math.max(e,0)},get volume(){return o.gain.value},set loop(e){i.loop=e},get loop(){return i.loop},duration:()=>i.buffer?.duration??0,time(){return f()%this.duration()},onEnd:e=>s.add(e),then(e){return this.onEnd(e)}}}function Xe(e){return Je(A.burpSnd,e)}function We(e,t){return new et(c,e,t)}function Ze(e=Pt,t=kt){let r=Mt.replace("{{user}}",e??Pt),n=Tt.replace("{{user}}",t??kt);try{return new tt(c,r,n,St.map(e=>e.name))}catch(i){let e=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,t=Fe(i).match(e),r=Number(t.groups.line)-14,n=t.groups.msg.trim(),s=t.groups.type.toLowerCase();throw new Error(`${s} shader line ${r}: ${n}`)}}function nt(e,t,r,n){let i=e.width/t,s={},o=n.split("").entries();for(let[a,h]of o)s[h]=new K(a%i*t,Math.floor(a/i)*r,t,r);return{tex:e,map:s,size:r}}function at(e,t,r,n=f.defTex,i=f.defShader,s={}){let o=je(i);if(!o||o instanceof st)return;let a=f.fixed||r?f.transform:V.cam.transform.mult(f.transform),h=[];for(let l of e){let e=mt(a.multVec2(l.pos));h.push(e.x,e.y,l.uv.x,l.uv.y,l.color.r/255,l.color.g/255,l.color.b/255,l.opacity)}f.renderer.push(d.TRIANGLES,h,t,o,n,s)}function ct(){f.renderer.flush()}function ft(){d.clear(d.COLOR_BUFFER_BIT),f.frameBuffer.bind(),d.clear(d.COLOR_BUFFER_BIT),f.bgColor||nr(()=>{Ht({width:dr(),height:cr(),quad:new K(0,0,dr()/64,cr()/64),tex:f.bgTex,fixed:!0})}),f.renderer.numDraws=0,f.fixed=!1,f.transformStack.length=0,f.transform=new j}function pt(e,t){f.postShader=e,f.postShaderUniform=t??null}function gt(){ct(),f.lastDrawCalls=f.renderer.numDraws,f.frameBuffer.unbind(),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight);let e=f.width,t=f.height;f.width=d.drawingBufferWidth/o,f.height=d.drawingBufferHeight/o,Kt({flipY:!0,tex:f.frameBuffer.tex,pos:new L(f.viewport.x,f.viewport.y),width:f.viewport.width,height:f.viewport.height,shader:f.postShader,uniform:"function"==typeof f.postShaderUniform?f.postShaderUniform():f.postShaderUniform,fixed:!0}),ct(),f.width=e,f.height=t}function mt(e){return new L(e.x/dr()*2-1,-e.y/cr()*2+1)}function Ut(e){f.transform=e.clone()}function Nt(...e){if(void 0===e[0])return;let t=O(...e);0===t.x&&0===t.y||f.transform.translate(t)}function Lt(...e){if(void 0===e[0])return;let t=O(...e);1===t.x&&1===t.y||f.transform.scale(t)}function Ot(e){e&&f.transform.rotate(e)}function Gt(){f.transformStack.push(f.transform.clone())}function qt(){f.transformStack.length>0&&(f.transform=f.transformStack.pop())}function Ht(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,r=e.height,n=It(e.anchor||Vt).scale(new L(t,r).scale(-.5)),i=e.quad||new K(0,0,1,1),s=e.color||q(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,h=e.tex?.1/e.tex.height:0,l=i.x+a,u=i.y+h,d=i.w-2*a,c=i.h-2*h;Gt(),Nt(e.pos),Ot(e.angle),Lt(e.scale),Nt(n),at([{pos:new L(-t/2,r/2),uv:new L(e.flipX?l+d:l,e.flipY?u:u+c),color:s,opacity:o},{pos:new L(-t/2,-r/2),uv:new L(e.flipX?l+d:l,e.flipY?u+c:u),color:s,opacity:o},{pos:new L(t/2,-r/2),uv:new L(e.flipX?l:l+d,e.flipY?u+c:u),color:s,opacity:o},{pos:new L(t/2,r/2),uv:new L(e.flipX?l:l+d,e.flipY?u:u+c),color:s,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),qt()}function Kt(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new K(0,0,1,1),r=e.tex.width*t.w,n=e.tex.height*t.h,i=new L(1);if(e.tiled){let s=Math.ceil((e.width||r)/r),o=Math.ceil((e.height||n)/n),a=It(e.anchor||Vt).add(new L(1,1)).scale(.5).scale(s*r,o*n);for(let h=0;h<s;h++)for(let s=0;s<o;s++)Ht(Object.assign({},e,{pos:(e.pos||new L(0)).add(new L(r*h,n*s)).sub(a),scale:i.scale(e.scale||new L(1)),tex:e.tex,quad:t,width:r,height:n,anchor:"topleft"}))}else e.width&&e.height?(i.x=e.width/r,i.y=e.height/n):e.width?(i.x=e.width/r,i.y=i.x):e.height&&(i.y=e.height/n,i.x=i.y),Ht(Object.assign({},e,{scale:i.scale(e.scale||new L(1)),tex:e.tex,quad:t,width:r,height:n}))}function Yt(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=Ke(e.sprite);if(!t||!t.data)return;let r=t.data.frames[e.frame??0];if(!r)throw new Error(`Frame not found: ${e.frame??0}`);Kt(Object.assign({},e,{tex:t.data.tex,quad:r.scale(e.quad??new K(0,0,1,1))}))}function jt(e,t,r,n,i,s=1){n=F(n%360),(i=F(i%360))<=n&&(i+=2*Math.PI);let o=[],a=(i-n)/Math.ceil((i-n)/F(8)*s);for(let h=n;h<i;h+=a)o.push(e.add(t*Math.cos(h),r*Math.sin(h)));return o.push(e.add(t*Math.cos(i),r*Math.sin(i))),o}function Qt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,r=e.height,n=It(e.anchor||Vt).add(1,1).scale(new L(t,r).scale(-.5)),i=[new L(0,0),new L(t,0),new L(t,r),new L(0,r)];if(e.radius){let n=Math.min(Math.min(t,r)/2,e.radius);i=[new L(n,0),new L(t-n,0),...jt(new L(t-n,n),n,n,270,360),new L(t,n),new L(t,r-n),...jt(new L(t-n,r-n),n,n,0,90),new L(t-n,r),new L(n,r),...jt(new L(n,r-n),n,n,90,180),new L(0,r-n),new L(0,n),...jt(new L(n,n),n,n,180,270)]}_t(Object.assign({},e,{offset:n,pts:i,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function zt(e){let{p1:t,p2:r}=e;if(!t||!r)throw new Error('drawLine() requires properties "p1" and "p2".');let n=e.width||1,i=r.sub(t).unit().normal().scale(.5*n);at([t.sub(i),t.add(i),r.add(i),r.sub(i)].map(t=>({pos:new L(t.x,t.y),uv:new L(0),color:e.color??G.WHITE,opacity:e.opacity??1})),[0,1,3,1,2,3],e.fixed,f.defTex,e.shader,e.uniform)}function Jt(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let r=t[0].sdist(t[1]);for(let e=1;e<t.length-1;e++)r=Math.min(t[e].sdist(t[e+1]),r);Math.min(e.radius,Math.sqrt(r)/2),zt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let n=1;n<t.length-2;n++){let r=t[n],i=t[n+1];zt(Object.assign({},e,{p1:r,p2:i}))}zt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let r=0;r<t.length-1;r++)zt(Object.assign({},e,{p1:t[r],p2:t[r+1]})),"none"!==e.join&&Wt(Object.assign({},e,{pos:t[r],radius:e.width/2}))}function Xt(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return _t(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function Wt(e){if("number"!=typeof e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&Zt(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function Zt(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,r=e.end??360,n=It(e.anchor??"center").scale(new L(-e.radiusX,-e.radiusY)),i=jt(n,e.radiusX,e.radiusY,t,r,e.resolution);i.unshift(n);let s=Object.assign({},e,{pts:i,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(i.length-1).fill(e.gradient[1])]}:{}});if(r-t>=360&&e.outline)return!1!==e.fill&&_t(Object.assign(s,{outline:null})),void _t(Object.assign(s,{pts:i.slice(1),fill:!1}));_t(s)}function _t(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(Gt(),Nt(e.pos),Lt(e.scale),Ot(e.angle),Nt(e.offset),!1!==e.fill){let r=e.color??G.WHITE,n=e.pts.map((t,n)=>({pos:new L(t.x,t.y),uv:new L(0,0),color:e.colors&&e.colors[n]?e.colors[n].mult(r):r,opacity:e.opacity??1})),i=[...Array(t-2).keys()].map(e=>[0,e+1,e+2]).flat();at(n,e.indices??i,e.fixed,f.defTex,e.shader,e.uniform)}e.outline&&Jt({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),qt()}}function $t(e,t,r){ct(),d.clear(d.STENCIL_BUFFER_BIT),d.enable(d.STENCIL_TEST),d.stencilFunc(d.NEVER,1,255),d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE),t(),ct(),d.stencilFunc(r,1,255),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),e(),ct(),d.disable(d.STENCIL_TEST)}function er(e,t){$t(e,t,d.EQUAL)}function tr(e,t){$t(e,t,d.NOTEQUAL)}function rr(){return(f.viewport.width+f.viewport.height)/(f.width+f.height)}function nr(e){ct();let t=f.width,r=f.height;f.width=f.viewport.width,f.height=f.viewport.height,e(),ct(),f.width=t,f.height=r}function ir(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(O(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&1===e.ch.length&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}k(T,"loadFont"),k(P,"loadBitmapFont"),k(B,"slice"),k(z,"loadSpriteAtlas"),k(X,"createSpriteSheet"),k(re,"loadSprite"),k(he,"loadPedit"),k(pe,"loadAseprite"),k(Ve,"loadShader"),k(xe,"loadShaderURL"),k(De,"loadSound"),k(Ue,"loadBean"),k(Ne,"getSprite"),k(Le,"getSound"),k(Oe,"getFont"),k(Ge,"getBitmapFont"),k(qe,"getShader"),k(He,"getAsset"),k(Ke,"resolveSprite"),k(Ye,"resolveSound"),k(je,"resolveShader"),k(Qe,"resolveFont"),k(ze,"volume"),k(Je,"play"),k(Xe,"burp"),k(We,"makeCanvas"),k(Ze,"makeShader"),k(nt,"makeFont"),k(at,"drawRaw"),k(ct,"flush"),k(ft,"frameStart"),k(pt,"usePostEffect"),k(gt,"frameEnd"),k(mt,"screen2ndc"),k(Ut,"pushMatrix"),k(Nt,"pushTranslate"),k(Lt,"pushScale"),k(Ot,"pushRotate"),k(Gt,"pushTransform"),k(qt,"popTransform"),k(Ht,"drawUVQuad"),k(Kt,"drawTexture"),k(Yt,"drawSprite"),k(jt,"getArcPts"),k(Qt,"drawRect"),k(zt,"drawLine"),k(Jt,"drawLines"),k(Xt,"drawTriangle"),k(Wt,"drawCircle"),k(Zt,"drawEllipse"),k(_t,"drawPolygon"),k($t,"drawStenciled"),k(er,"drawMasked"),k(tr,"drawSubtracted"),k(rr,"getViewportScale"),k(nr,"drawUnscaled"),k(ir,"applyCharTransform");let sr=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function or(e){let t={},r=e.replace(sr,"$2"),n=0;for(let i of e.matchAll(sr)){let e=i.index-n;for(let r=0;r<i.groups.text.length;r++)t[r+e]=[i.groups.style];n+=i[0].length-i.groups.text.length}return{charStyleMap:t,text:r}}k(or,"compileStyledText");let ar={};function hr(e){if(void 0===e.text)throw new Error('formatText() requires property "text".');let t=Qe(e.font);if(""===e.text||t instanceof st||!t)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:r,text:n}=or(e.text+""),i=Ce(n);if(t instanceof M||"string"==typeof t){let e=t instanceof M?t.fontface.family:t,r=t instanceof M?{outline:t.outline,filter:t.filter}:{outline:null,filter:bt},n=ar[e]??{font:{tex:new $e(c,2048,2048,{filter:r.filter}),map:{},size:64},cursor:new L(0),outline:r.outline};ar[e]||(ar[e]=n),t=n.font;for(let s of i)if(!n.font.map[s]){let r=h;r.clearRect(0,0,a.width,a.height),r.font=`${t.size}px ${e}`,r.textBaseline="top",r.textAlign="left",r.fillStyle="#ffffff";let i=r.measureText(s),o=Math.ceil(i.width),l=t.size;n.outline&&(r.lineJoin="round",r.lineWidth=2*n.outline.width,r.strokeStyle=n.outline.color.toHex(),r.strokeText(s,n.outline.width,n.outline.width),o+=2*n.outline.width,l+=3*n.outline.width),r.fillText(s,n.outline?.width??0,n.outline?.width??0);let u=r.getImageData(0,0,o,l);if(n.cursor.x+o>2048&&(n.cursor.x=0,n.cursor.y+=l,n.cursor.y>2048))throw new Error("Font atlas exceeds character limit");t.tex.update(u,n.cursor.x,n.cursor.y),t.map[s]=new K(n.cursor.x,n.cursor.y,o,l),n.cursor.x+=o}}let s=e.size||t.size,o=O(e.scale??1).scale(s/t.size),l=e.lineSpacing??0,u=e.letterSpacing??0,d=0,f=0,p=0,g=[],m=[],w=0,A=null,y=null;for(;w<i.length;){let r=i[w];if("\n"===r)p+=s+l,g.push({width:d-u,chars:m}),A=null,y=null,d=0,m=[];else{let n=t.map[r];if(n){let a=n.w*o.x;e.width&&d+a>e.width&&(p+=s+l,null!=A&&(w-=m.length-A,r=i[w],n=t.map[r],a=n.w*o.x,m=m.slice(0,A-1),d=y),A=null,y=null,g.push({width:d-u,chars:m}),d=0,m=[]),m.push({tex:t.tex,width:n.w,height:n.h,quad:new K(n.x/t.tex.width,n.y/t.tex.height,n.w/t.tex.width,n.h/t.tex.height),ch:r,pos:new L(d,p),opacity:e.opacity??1,color:e.color??G.WHITE,scale:O(o),angle:0})," "===r&&(A=m.length,y=d),d+=a,f=Math.max(f,d),d+=u}}w++}g.push({width:d-u,chars:m}),p+=s,e.width&&(f=e.width);let v=[];for(let a of g){let n=(f-a.width)*Dt(e.align??"left");for(let i of a.chars){let s=t.map[i.ch],a=v.length;if(i.pos=i.pos.add(n,0).add(s.w*o.x*.5,s.h*o.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(a,i.ch):e.transform;t&&ir(i,t)}if(r[a]){let t=r[a];for(let r of t){let t=e.styles[r],n="function"==typeof t?t(a,i.ch):t;n&&ir(i,n)}}v.push(i)}}return{width:f,height:p,chars:v,opt:e}}function lr(e){ur(hr(e))}function ur(e){Gt(),Nt(e.opt.pos),Ot(e.opt.angle),Nt(It(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(t=>{Ht({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),qt()}function dr(){return f.width}function cr(){return f.height}function fr(e){return new L((e.x-f.viewport.x)*dr()/f.viewport.width,(e.y-f.viewport.y)*cr()/f.viewport.height)}function pr(e){return new L(e.x*f.viewport.width/f.width,e.y*f.viewport.height/f.height)}function gr(){return fr(l.mousePos())}k(hr,"formatText"),k(lr,"drawText"),k(ur,"drawFormattedText"),k(dr,"width"),k(cr,"height"),k(fr,"windowToContent"),k(pr,"contentToView"),k(gr,"mousePos");let mr=!1,wr={inspect:!1,timeScale:1,showLog:!0,fps:()=>l.fps(),numFrames:()=>l.numFrames(),stepFrame:Zn,drawCalls:()=>f.lastDrawCalls,clearLog:()=>V.logs=[],log:t=>{let r=e.logMax??8;V.logs.unshift({msg:t,time:l.time()}),V.logs.length>r&&(V.logs=V.logs.slice(0,r))},error:e=>wr.log(new Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Kn("*",{recursive:!0}).length,get paused(){return mr},set paused(e){mr=e,e?A.ctx.suspend():A.ctx.resume()}};function Ar(){return l.dt()*wr.timeScale}function yr(...e){return e.length>0&&(V.cam.pos=O(...e)),V.cam.pos?V.cam.pos.clone():Fn()}function vr(...e){return e.length>0&&(V.cam.scale=O(...e)),V.cam.scale.clone()}function Vr(e){return void 0!==e&&(V.cam.angle=e),V.cam.angle}function xr(e=12){V.cam.shake+=e}function Er(e){return V.cam.transform.multVec2(e)}function br(e){return V.cam.transform.invert().multVec2(e)}function Sr(e){let t=new j;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function Rr(e=[]){let t=new Map,r={},n=new ve,i=[],s=null,o=!1,a={id:Be(),hidden:!1,transform:new j,children:[],parent:null,set paused(e){if(e!==o){o=e;for(let t of i)t.paused=e}},get paused(){return o},add(e=[]){let t=Array.isArray(e)?Rr(e):e;if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t.parent=this,t.transform=Sr(t),this.children.push(t),t.trigger("add",t),V.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);if(-1!==t){e.parent=null,this.children.splice(t,1);let r=k(e=>{e.trigger("destroy"),V.events.trigger("destroy",e),e.children.forEach(e=>r(e))},"trigger");r(e)}},removeAll(e){if(e)this.get(e).forEach(e=>this.remove(e));else for(let t of[...this.children])this.remove(t)},update(){this.paused||(this.children.sort((e,t)=>(e.z??0)-(t.z??0)).forEach(e=>e.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let e=f.fixed;this.fixed&&(f.fixed=!0),Gt(),Nt(this.pos),Lt(this.scale),Ot(this.angle);let t=this.children.sort((e,t)=>(e.z??0)-(t.z??0));if(this.mask){let e={intersect:er,subtract:tr}[this.mask];if(!e)throw new Error(`Invalid mask func: "${this.mask}"`);e(()=>{t.forEach(e=>e.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),t.forEach(e=>e.draw());qt(),f.fixed=e,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(Gt(),Nt(this.pos),Lt(this.scale),Ot(this.angle),this.children.sort((e,t)=>(e.z??0)-(t.z??0)).forEach(e=>e.drawInspect()),this.trigger("drawInspect"),qt())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let n=[];e.id&&(this.unuse(e.id),r[e.id]=[],n=r[e.id],t.set(e.id,e));for(let t in e){if(Bt.has(t))continue;let r=Object.getOwnPropertyDescriptor(e,t);if("function"==typeof r.value&&(e[t]=e[t].bind(this)),r.set&&Object.defineProperty(e,t,{set:r.set.bind(this)}),r.get&&Object.defineProperty(e,t,{get:r.get.bind(this)}),Ft.has(t)){let r="add"===t?()=>{s=k(e=>n.push(e),"onCurCompCleanup"),e[t](),s=null}:e[t];n.push(this.on(t,r).cancel)}else{if(void 0!==this[t])throw new Error(`Duplicate component property: "${t}"`);Object.defineProperty(this,t,{get:()=>e[t],set:r=>e[t]=r,configurable:!0,enumerable:!0}),n.push(()=>delete this[t])}}let i=k(()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)},"checkDeps");e.destroy&&n.push(e.destroy.bind(this)),this.exists()?(i(),e.add&&(s=k(e=>n.push(e),"onCurCompCleanup"),e.add.call(this),s=null)):e.require&&n.push(this.on("add",i).cancel)},unuse(e){r[e]&&(r[e].forEach(e=>e()),delete r[e]),t.has(e)&&t.delete(e)},c:e=>t.get(e),get(e,t={}){let r=t.recursive?this.children.flatMap(k(function e(t){return[t,...t.children.flatMap(e)]},"recurse")):this.children;if(r=r.filter(t=>!e||t.is(e)),t.liveUpdate){let n=k(e=>t.recursive?this.isAncestorOf(e):e.parent===this,"isChild"),i=[];i.push(kr(t=>{n(t)&&t.is(e)&&r.push(t)})),i.push(Br(t=>{if(n(t)&&t.is(e)){let e=r.findIndex(e=>e.id===t.id);-1!==e&&r.splice(e,1)}})),this.onDestroy(()=>{for(let e of i)e.cancel()})}return r},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return V.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let r=n.on(e,t.bind(this));return s&&s(()=>r.cancel()),r},trigger(e,...t){n.trigger(e,...t),V.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[r,n]of t)e[r]=n.inspect?n.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){n.clear()}},h=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let u of h)a[u]=(...e)=>{let t=l[u](...e);return i.push(t),a.onDestroy(()=>t.cancel()),t};for(let l of e)a.use(l);return a}function Mr(e,t,r){return V.objEvents[e]||(V.objEvents[e]=new we),V.objEvents.on(e,(e,...n)=>{e.is(t)&&r(e,...n)})}k(Ar,"dt"),k(yr,"camPos"),k(vr,"camScale"),k(Vr,"camRot"),k(xr,"shake"),k(Er,"toScreen"),k(br,"toWorld"),k(Sr,"calcTransform"),k(Rr,"make"),k(Mr,"on");let Tr=ke(e=>{let t=Gn([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}},(e,t)=>Mr("update",e,t)),Pr=ke(e=>{let t=Gn([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}},(e,t)=>Mr("draw",e,t)),kr=ke(e=>V.events.on("add",e),(e,t)=>Mr("add",e,t)),Br=ke(e=>V.events.on("destroy",e),(e,t)=>Mr("destroy",e,t));function Fr(e,t,r){return Mr("collide",e,(e,n,i)=>n.is(t)&&r(e,n,i))}function Ir(e,t,r){return Mr("collideUpdate",e,(e,n,i)=>n.is(t)&&r(e,n,i))}function Dr(e,t,r){return Mr("collideEnd",e,(e,n,i)=>n.is(t)&&r(e,n,i))}function Cr(e,t){Kn(e,{recursive:!0}).forEach(t),kr(e,t)}k(Fr,"onCollide"),k(Ir,"onCollideUpdate"),k(Dr,"onCollideEnd"),k(Cr,"forAllCurrentAndFuture");let Ur=ke(e=>l.onMousePress(e),(e,t)=>{let r=[];return Cr(e,e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");r.push(e.onClick(()=>t(e)))}),Ae.join(r)});function Nr(e,t){let r=[];return Cr(e,e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");r.push(e.onHover(()=>t(e)))}),Ae.join(r)}function Lr(e,t){let r=[];return Cr(e,e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");r.push(e.onHoverUpdate(()=>t(e)))}),Ae.join(r)}function Or(e,t){let r=[];return Cr(e,e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");r.push(e.onHoverEnd(()=>t(e)))}),Ae.join(r)}function Gr(e){V.gravity=e}function qr(){return V.gravity}function Hr(...e){1===e.length||2===e.length?(f.bgColor=q(e[0]),e[1]&&(f.bgAlpha=e[1])):(3===e.length||4===e.length)&&(f.bgColor=q(e[0],e[1],e[2]),e[3]&&(f.bgAlpha=e[3])),d.clearColor(f.bgColor.r/255,f.bgColor.g/255,f.bgColor.b/255,f.bgAlpha)}function Kr(){return f.bgColor.clone()}function Yr(...e){return{id:"pos",pos:O(...e),moveBy(...e){this.pos=this.pos.add(O(...e))},move(...e){this.moveBy(O(...e).scale(Ar()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(O(e[0],e[1]),e[2]);let t=e[0],r=e[1];if(void 0===r)return void(this.pos=O(t));let n=t.sub(this.pos);n.len()<=r*Ar()?this.pos=O(t):this.move(n.unit().scale(r))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let e=this.worldPos();return tn(this)?e:Er(e)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Wt({color:q(255,0,0),radius:4/rr()})}}}function jr(...e){return 0===e.length?jr(1):{id:"scale",scale:O(...e),scaleTo(...e){this.scale=O(...e)},scaleBy(...e){this.scale.scale(O(...e))},inspect(){return`(${Jr(this.scale.x,2)}, ${Jr(this.scale.y,2)})`}}}function Qr(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function zr(...e){return{id:"color",color:q(...e),inspect(){return this.color.toString()}}}function Jr(e,t){return Number(e.toFixed(t))}function Xr(e){return{id:"opacity",opacity:e??1,inspect(){return`${Jr(this.opacity,1)}`},fadeOut(e=1,t=wt.linear){return Qn(this.opacity,0,e,e=>this.opacity=e,t)}}}function Wr(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function Zr(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function _r(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??O(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function $r(e,t){let r="number"==typeof e?L.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(r.scale(t))}}}k(Nr,"onHover"),k(Lr,"onHoverUpdate"),k(Or,"onHoverEnd"),k(Gr,"setGravity"),k(qr,"getGravity"),k(Hr,"setBackground"),k(Kr,"getBackground"),k(Yr,"pos"),k(jr,"scale"),k(Qr,"rotate"),k(zr,"color"),k(Jr,"toFixed"),k(Xr,"opacity"),k(Wr,"anchor"),k(Zr,"z"),k(_r,"follow"),k($r,"move");function en(e={}){let t=e.distance??200,r=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=this.screenPos(),r=new ce(O(0),dr(),cr());return!se(r,e)&&r.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(r||(this.trigger("exitView"),r=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(r&&(this.trigger("enterView"),r=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function tn(e){return!!e.fixed||!!e.parent&&tn(e.parent)}function rn(e={}){let t={},r=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>l.setCursor(this.area.cursor)),this.onCollideUpdate((e,n)=>{t[e.id]||this.trigger("collide",e,n),t[e.id]=n,r.add(e.id)})},update(){for(let e in t)r.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);r.clear()},drawInspect(){let e=this.localArea();Gt(),Lt(this.area.scale),Nt(this.area.offset);let t={outline:{width:4/rr(),color:q(0,0,255)},anchor:this.anchor,fill:!1,fixed:tn(this)};e instanceof ce?Qt({...t,pos:e.pos,width:e.width,height:e.height}):e instanceof ge?_t({...t,pts:e.pts}):e instanceof fe&&Wt({...t,pos:e.center,radius:e.radius}),qt()},area:{shape:e.shape??null,scale:e.scale?O(e.scale):O(1),offset:e.offset??O(0),cursor:e.cursor??null},isClicked(){return l.isMousePressed()&&this.isHovering()},isHovering(){let e=tn(this)?gr():br(gr());return this.hasPoint(e)},checkCollision:e=>t[e.id]??null,getCollisions:()=>Object.values(t),isColliding:e=>!!t[e.id],isOverlapping(e){let r=t[e.id];return r&&r.hasOverlap()},onClick(e){let t=l.onMousePress("left",()=>{this.isHovering()&&e()});return this.onDestroy(()=>t.cancel()),t},onHover(e){let t=!1;return this.onUpdate(()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())})},onHoverUpdate(e){return this.onUpdate(()=>{this.isHovering()&&e()})},onHoverEnd(e){let t=!1;return this.onUpdate(()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()})},onCollide(e,t){return"function"==typeof e&&void 0===t?this.on("collide",e):"string"==typeof e?this.onCollide((r,n)=>{r.is(e)&&t(r,n)}):void 0},onCollideUpdate(e,t){return"function"==typeof e&&void 0===t?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",(r,n)=>r.is(e)&&t(r,n)):void 0},onCollideEnd(e,t){return"function"==typeof e&&void 0===t?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",r=>r.is(e)&&t(r)):void 0},hasPoint(e){return ue(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof ge||e instanceof ce))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(O(this.area.scale??1)).translate(this.area.offset);if(e instanceof ce){let r=It(this.anchor||Vt).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(r)}return e.transform(t)},screenArea(){let e=this.worldArea();return tn(this)?e:e.transform(V.cam.transform)}}}function nn(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function sn(e,t={}){let r=null,n=null,i=null,s=new ye;if(!e)throw new Error("Please pass the resource name or data to sprite()");let o=k((e,t,r,n)=>{let i=O(1,1);return r&&n?(i.x=r/(e.width*t.w),i.y=n/(e.height*t.h)):r?(i.x=r/(e.width*t.w),i.y=i.x):n&&(i.y=n/(e.height*t.h),i.x=i.y),i},"calcTexScale");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new K(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,draw(){if(!r)return;let e=r.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(r.slice9){let{left:n,right:i,top:s,bottom:o}=r.slice9,a=r.tex.width*e.w,h=r.tex.height*e.h,l=this.width-n-i,u=this.height-s-o,d=n/a,c=i/a,f=1-d-c,p=s/h,g=o/h,m=1-p-g,w=[Y(0,0,d,p),Y(d,0,f,p),Y(d+f,0,c,p),Y(0,p,d,m),Y(d,p,f,m),Y(d+f,p,c,m),Y(0,p+m,d,g),Y(d,p+m,f,g),Y(d+f,p+m,c,g),Y(0,0,n,s),Y(n,0,l,s),Y(n+l,0,i,s),Y(0,s,n,u),Y(n,s,l,u),Y(n+l,s,i,u),Y(0,s+u,n,o),Y(n,s+u,l,o),Y(n+l,s+u,i,o)];for(let A=0;A<9;A++){let n=w[A],i=w[A+9];Kt(Object.assign(nn(this),{pos:i.pos(),tex:r.tex,quad:e.scale(n),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:i.w,height:i.h}))}}else Kt(Object.assign(nn(this),{tex:r.tex,quad:e.scale(this.quad??new K(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let n=k(e=>{let n=e.frames[0].clone();t.quad&&(n=n.scale(t.quad));let i=o(e.tex,n,t.width,t.height);this.width=e.tex.width*n.w*i.x,this.height=e.tex.height*n.h*i.y,t.anim&&this.play(t.anim),r=e,s.trigger(r)},"setSpriteData"),i=Ke(e);i?i.onLoad(n):Sn(()=>n(Ke(e).data))},update(){if(!n)return;let e=r.anims[n.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");n.timer+=Ar()*this.animSpeed,n.timer>=1/n.speed&&(n.timer=0,this.frame+=i,(this.frame<Math.min(e.from,e.to)||this.frame>Math.max(e.from,e.to))&&(n.loop?n.pingpong?(this.frame-=i,i*=-1,this.frame+=i):this.frame=e.from:(this.frame=e.to,n.onEnd(),this.stop())))}else this.frame=e},play(e,t={}){if(!r)return void s.add(()=>this.play(e,t));let o=r.anims[e];if(void 0===o)throw new Error(`Anim not found: ${e}`);n&&this.stop(),n="number"==typeof o?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??o.loop??!1,pingpong:t.pingpong??o.pingpong??!1,speed:t.speed??o.speed??10,onEnd:t.onEnd??(()=>{})},i="number"==typeof o?null:o.from<o.to?1:-1,this.frame="number"==typeof o?o:o.from,this.trigger("animStart",e)},stop(){if(!n)return;let e=n.name;n=null,this.trigger("animEnd",e)},numFrames:()=>r?.frames.length??0,curAnim:()=>n?.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new ce(O(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function on(e,t={}){function r(e){let r=hr(Object.assign(nn(e),{text:e.text+"",size:e.textSize,font:e.font,width:t.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return t.width||(e.width=r.width/(e.scale?.x||1)),e.height=r.height/(e.scale?.y||1),r}k(r,"update");let n={id:"text",set text(t){e=t,r(this)},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,add(){Sn(()=>r(this))},draw(){ur(r(this))},renderArea(){return new ce(O(0),this.width,this.height)}};return r(n),n}function an(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,radius:t.radius,draw(){_t(Object.assign(nn(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:t.fill}))},renderArea(){return new ge(this.pts)},inspect(){return this.pts.map(e=>`[${e.x},${e.y}]`).join(",")}}}function hn(e,t,r={}){return{id:"rect",width:e,height:t,radius:r.radius||0,draw(){Qt(Object.assign(nn(this),{width:this.width,height:this.height,radius:this.radius,fill:r.fill}))},renderArea(){return new ce(O(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function ln(e,t){return{id:"rect",width:e,height:t,draw(){Ht(Object.assign(nn(this),{width:this.width,height:this.height}))},renderArea(){return new ce(O(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function un(e,t={}){return{id:"circle",radius:e,draw(){Wt(Object.assign(nn(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new ce(new L(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function dn(e=1,t=q(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}function cn(){return{id:"timer",wait(e,t){let r=[];t&&r.push(t);let n=0,i=this.onUpdate(()=>{n+=Ar(),n>=e&&(r.forEach(e=>e()),i.cancel())});return{get paused(){return i.paused},set paused(e){i.paused=e},cancel:i.cancel,onEnd(e){r.push(e)},then(e){return this.onEnd(e),this}}},loop(e,t){let r=null,n=k(()=>{r=this.wait(e,n),t()},"newAction");return r=this.wait(0,n),{get paused(){return r.paused},set paused(e){r.paused=e},cancel:()=>r.cancel()}},tween(e,t,r,n,i=wt.linear){let s=0,o=[],a=this.onUpdate(()=>{s+=Ar();let h=Math.min(s/r,1);n(C(e,t,i(h))),1===h&&(a.cancel(),n(t),o.forEach(e=>e()))});return{get paused(){return a.paused},set paused(e){a.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){a.cancel()},finish(){a.cancel(),n(t),o.forEach(e=>e())}}}}}k(en,"offscreen"),k(tn,"isFixed"),k(rn,"area"),k(nn,"getRenderProps"),k(sn,"sprite"),k(on,"text"),k(an,"polygon"),k(hn,"rect"),k(ln,"uvquad"),k(un,"circle"),k(dn,"outline"),k(cn,"timer");let fn;function pn(e={}){let t=null,r=null,n=!1;return{id:"body",require:["pos","area"],vel:new L(0),jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw new Error("Can't set body mass to 0");this.onCollideUpdate((e,t)=>{if(e.is("body")&&!t.resolved&&(this.trigger("beforePhysicsResolve",t),e.trigger("beforePhysicsResolve",t.reverse()),!(t.resolved||this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let r=!this.isStatic&&e.isStatic?t:t.reverse();r.source.pos=r.source.pos.add(r.displacement),r.source.transform=Sr(r.source)}else{let r=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/r)),e.pos=e.pos.add(t.displacement.scale(-this.mass/r)),this.transform=Sr(this),e.transform=Sr(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}}),this.onPhysicsResolve(e=>{V.gravity&&(e.isBottom()&&this.isFalling()?(this.vel.y=0,t=e.target,r=e.target.pos,n?n=!1:this.trigger("ground",t)):e.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",e.target)))})},update(){if(!V.gravity||this.isStatic)return;if(n&&(t=null,r=null,this.trigger("fallOff"),n=!1),t){if(this.isColliding(t)&&t.exists()&&t.is("body"))return!t.pos.eq(r)&&!1!==e.stickToPlatform&&this.moveBy(t.pos.sub(r)),void(r=t.pos);n=!0}let i=this.vel.y;this.vel.y+=V.gravity*this.gravityScale*Ar(),this.vel.y=Math.min(this.vel.y,e.maxVelocity??65536),i<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>t,isGrounded:()=>null!==t,isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(e){t=null,r=null,this.vel.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function gn(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround(()=>{t=this.numJumps})},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${t}`}}function mn(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t}}}function wn(){return{id:"fixed",fixed:!0}}function An(e){return{id:"stay",stay:!0,scenesToStay:e}}function yn(e,t){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){let r=e;this.setHP(e+t),this.trigger("heal",e-r)},hp:()=>e,maxHP:()=>t??null,setMaxHP(e){t=e},setHP(r){(e=t?Math.min(t,r):r)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function vn(e,t={}){if(null==e)throw new Error("lifespan() requires time");let r=t.fade??0;return{id:"lifespan",async add(){await Yn(e),r>0&&this.opacity&&await Qn(this.opacity,0,r,e=>this.opacity=e,wt.linear),this.destroy()}}}function Vn(e,t,r){if(!e)throw new Error("state() requires an initial state");let n={};function i(e){n[e]||(n[e]={enter:new ye,end:new ye,update:new ye,draw:new ye})}function s(e,t,r){return i(t),n[t][e].add(r)}function o(e,t,...r){i(t),n[t][e].trigger(...r)}k(i,"initStateEvents"),k(s,"on"),k(o,"trigger");let a=!1;return{id:"state",state:e,enterState(e,...n){if(a=!0,t&&!t.includes(e))throw new Error(`State not found: ${e}`);let i=this.state;if(r){if(!r?.[i])return;let t="string"==typeof r[i]?[r[i]]:r[i];if(!t.includes(e))throw new Error(`Cannot transition state from "${i}" to "${e}". Available transitions: ${t.map(e=>`"${e}"`).join(", ")}`)}o("end",i,...n),this.state=e,o("enter",e,...n),o("enter",`${i} -> ${e}`,...n)},onStateTransition:(e,t,r)=>s("enter",`${e} -> ${t}`,r),onStateEnter:(e,t)=>s("enter",e,t),onStateUpdate:(e,t)=>s("update",e,t),onStateDraw:(e,t)=>s("draw",e,t),onStateEnd:(e,t)=>s("end",e,t),update(){a||(o("enter",e),a=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return this.state}}}function xn(e=1){let t=0,r=!1;return{require:["opacity"],add(){this.opacity=0},update(){r||(t+=Ar(),this.opacity=U(t,0,e,0,1),t>=e&&(this.opacity=1,r=!0))}}}function En(e="intersect"){return{id:"mask",mask:e}}function bn(e){return{add(){this.canvas=e}}}function Sn(e){y.loaded?e():V.events.on("load",e)}function Rn(e,t){V.scenes[e]=t}function Mn(e,...t){if(!V.scenes[e])throw new Error(`Scene not found: ${e}`);V.events.onOnce("frameEnd",()=>{V.events.trigger("sceneLeave",e),l.events.clear(),V.events.clear(),V.objEvents.clear(),[...V.root.children].forEach(t=>{(!t.stay||t.scenesToStay&&!t.scenesToStay.includes(e))&&V.root.remove(t)}),V.root.clearEvents(),fi(),V.cam={pos:null,scale:O(1),angle:0,shake:0,transform:new j},V.scenes[e](...t)})}function Tn(e){return V.events.on("sceneLeave",e)}function Pn(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(kn(e,t),t):null}}function kn(e,t){window.localStorage[e]=JSON.stringify(t)}function Bn(t,...r){let n,i=t(pi);n="function"==typeof i?i(...r)(pi):i;for(let s in n)pi[s]=n[s],!1!==e.global&&(window[s]=n[s]);return pi}function Fn(){return O(dr()/2,cr()/2)}var In;function Dn(e={}){let t=O(0),r=e.isObstacle??!1,n=e.cost??0,i=e.edges??[],s=k(()=>{let e={left:1,top:2,right:4,bottom:8};return i.map(t=>e[t]||0).reduce((e,t)=>e|t,0)},"getEdgeMask"),o=s();return{id:"tile",tilePosOffset:e.offset??O(0),set tilePos(e){let r=this.getLevel();t=e.clone(),this.pos=O(this.tilePos.x*r.tileWidth(),this.tilePos.y*r.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(e){r!==e&&(r=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return r},set cost(e){n!==e&&(n=e,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(e){i=e,o=s(),this.getLevel().invalidateNavigationMap()},get edges(){return i},get edgeMask(){return o},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(O(-1,0))},moveRight(){this.tilePos=this.tilePos.add(O(1,0))},moveUp(){this.tilePos=this.tilePos.add(O(0,-1))},moveDown(){this.tilePos=this.tilePos.add(O(0,1))}}}function Cn(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let r=Gn([Yr(t.pos??O(0))]),n=e.length,i=0,s=null,o=null,a=null,h=null,l=k(e=>e.x+e.y*i,"tile2Hash"),u=k(e=>O(Math.floor(e%i),Math.floor(e/i)),"hash2Tile"),d=k(()=>{s=[];for(let e of r.children)c(e)},"createSpatialMap"),c=k(e=>{let t=l(e.tilePos);s[t]?s[t].push(e):s[t]=[e]},"insertIntoSpatialMap"),f=k(e=>{let t=l(e.tilePos);if(s[t]){let r=s[t].indexOf(e);r>=0&&s[t].splice(r,1)}},"removeFromSpatialMap"),p=k(()=>{let e=!1;for(let t of r.children){let n=r.pos2Tile(t.pos);(t.tilePos.x!=n.x||t.tilePos.y!=n.y)&&(e=!0,f(t),t.tilePos.x=n.x,t.tilePos.y=n.y,c(t))}e&&r.trigger("spatial_map_changed")},"updateSpatialMap"),g=k(()=>{let e=r.getSpatialMap(),t=r.numRows()*r.numColumns();o?o.length=t:o=new Array(t),o.fill(1,0,t);for(let r=0;r<e.length;r++){let t=e[r];if(t){let e=0;for(let r of t){if(r.isObstacle){e=1/0;break}e+=r.cost}o[r]=e||1}}},"createCostMap"),m=k(()=>{let e=r.getSpatialMap(),t=r.numRows()*r.numColumns();a?a.length=t:a=new Array(t),a.fill(15,0,t);for(let r=0;r<e.length;r++){let t=e[r];if(t){let e=t.length,n=15;for(let r=0;r<e;r++)n|=t[r].edgeMask;a[r]=n}}},"createEdgeMap"),w=k(()=>{let e=r.numRows()*r.numColumns(),t=k((e,t)=>{let r=[];for(r.push(e);r.length>0;){let e=r.pop();v(e).forEach(e=>{h[e]<0&&(h[e]=t,r.push(e))})}},"traverse");h?h.length=e:h=new Array(e),h.fill(-1,0,e);let n=0;for(let r=0;r<o.length;r++)h[r]>=0||t(r,n),n++},"createConnectivityMap"),A=k((e,t)=>o[t],"getCost"),y=k((e,t)=>{let r=u(e),n=u(t);return r.dist(n)},"getHeuristic"),v=k((e,t)=>{let r=[],s=Math.floor(e%i),h=s>0&&1&a[e]&&o[e-1]!==1/0,l=e>=i&&2&a[e]&&o[e-i]!==1/0,u=s<i-1&&4&a[e]&&o[e+1]!==1/0,d=e<i*n-i-1&&8&a[e]&&o[e+i]!==1/0;return t?(h&&(l&&r.push(e-i-1),r.push(e-1),d&&r.push(e+i-1)),l&&r.push(e-i),u&&(l&&r.push(e-i+1),r.push(e+1),d&&r.push(e+i+1)),d&&r.push(e+i)):(h&&r.push(e-1),l&&r.push(e-i),u&&r.push(e+1),d&&r.push(e+i)),r},"getNeighbours"),V={id:"level",tileWidth:()=>t.tileWidth,tileHeight:()=>t.tileHeight,spawn(e,...n){let i=O(...n),o=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(t.tiles[e]){if("function"!=typeof t.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return t.tiles[e](i)}if(t.wildcardTile)return t.wildcardTile(e,i)})();if(!o)return null;let a=!1,h=!1;for(let t of o)"tile"===t.id&&(h=!0),"pos"===t.id&&(a=!0);a||o.push(Yr()),h||o.push(Dn());let l=r.add(o);return a&&(l.tilePosOffset=l.pos.clone()),l.tilePos=i,s&&(c(l),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),l},numColumns:()=>i,numRows:()=>n,levelWidth(){return i*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...e){return O(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=O(...e);return O(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(s||d(),s),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt(e){s||d();let t=l(e);return s[t]||[]},update(){s&&p()},invalidateNavigationMap(){o=null,a=null,h=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,t,r={}){if(o||g(),a||m(),h||w(),e.x<0||e.x>=i||e.y<0||e.y>=n||t.x<0||t.x>=i||t.y<0||t.y>=n)return null;let s=l(e),d=l(t);if(o[d]===1/0)return null;if(s===d)return[];if(-1!=h[s]&&h[s]!==h[d])return null;let c=new Ie((e,t)=>e.cost<t.cost);c.insert({cost:0,node:s});let f=new Map;f.set(s,s);let p=new Map;for(p.set(s,0);0!==c.length;){let e=c.remove()?.node;if(e===d)break;let t=v(e,r.allowDiagonals);for(let r of t){let t=(p.get(e)||0)+A(e,r)+y(r,d);(!p.has(r)||t<p.get(r))&&(p.set(r,t),c.insert({cost:t,node:r}),f.set(r,e))}}let V=[],x=d,E=u(x);for(V.push(E);x!==s;){x=f.get(x);let e=u(x);V.push(e)}return V.reverse()},getPath(e,t,r={}){let n=this.tileWidth(),i=this.tileHeight(),s=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),r);return s?[e,...s.slice(1,-1).map(e=>e.scale(n,i).add(n/2,i/2)),t]:null}};return r.use(V),r.onNavigationMapInvalid(()=>{r.invalidateNavigationMap(),r.trigger("navigation_map_changed")}),e.forEach((e,t)=>{let n=e.split("");i=Math.max(n.length,i),n.forEach((e,n)=>{r.spawn(e,O(n,t))})}),r}function Un(e={}){let t=null,r=null,n=null,i=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>r&&n?r[n]:null,getPath:()=>r?r.slice():null,getTarget:()=>t,isNavigationFinished:()=>!r||null===n,isTargetReachable:()=>null!==r,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,r=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n=r?0:null,r?(i||(i=this.getLevel().onNavigationMapChanged(()=>{r&&null!==n&&(r=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n=r?0:null,r?this.trigger("navigation-next",this,r[n]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>i.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,r[n])):this.trigger("navigation-ended",this)},update(){if(r&&null!==n){if(this.pos.sdist(r[n])<2){if(n===r.length-1)return this.pos=t.clone(),n=null,this.trigger("navigation-ended",this),void this.trigger("target-reached",this);n++,this.trigger("navigation-next",this,r[n])}this.moveTo(r[n],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(r)})}}function Nn(e){let t=l.canvas.captureStream(e),r=A.ctx.createMediaStreamDestination();A.masterNode.connect(r);let n=new MediaRecorder(t),i=[];return n.ondataavailable=e=>{e.data.size>0&&i.push(e.data)},n.onerror=()=>{A.masterNode.disconnect(r),t.getTracks().forEach(e=>e.stop())},n.start(),{resume(){n.resume()},pause(){n.pause()},stop:()=>(n.stop(),A.masterNode.disconnect(r),t.getTracks().forEach(e=>e.stop()),new Promise(e=>{n.onstop=()=>{e(new Blob(i,{type:"video/mp4"}))}})),download(e="kaboom.mp4"){this.stop().then(t=>Me(e,t))}}}function Ln(){return document.activeElement===l.canvas}function On(e){e.destroy()}k(pn,"body"),k(gn,"doubleJump"),k(mn,"shader"),k(wn,"fixed"),k(An,"stay"),k(yn,"health"),k(vn,"lifespan"),k(Vn,"state"),k(xn,"fadeIn"),k(En,"mask"),k(bn,"drawon"),k(Sn,"onLoad"),k(Rn,"scene"),k(Mn,"go"),k(Tn,"onSceneLeave"),k(Pn,"getData"),k(kn,"setData"),k(Bn,"plug"),k(Fn,"center"),(In=fn||={})[In.None=0]="None",In[In.Left=1]="Left",In[In.Top=2]="Top",In[In.LeftTop=3]="LeftTop",In[In.Right=4]="Right",In[In.Horizontal=5]="Horizontal",In[In.RightTop=6]="RightTop",In[In.HorizontalTop=7]="HorizontalTop",In[In.Bottom=8]="Bottom",In[In.LeftBottom=9]="LeftBottom",In[In.Vertical=10]="Vertical",In[In.LeftVertical=11]="LeftVertical",In[In.RightBottom=12]="RightBottom",In[In.HorizontalBottom=13]="HorizontalBottom",In[In.RightVertical=14]="RightVertical",In[In.All=15]="All",k(Dn,"tile"),k(Cn,"addLevel"),k(Un,"agent"),k(Nn,"record"),k(Ln,"isFocused"),k(On,"destroy");let Gn=V.root.add.bind(V.root),qn=V.root.readd.bind(V.root),Hn=V.root.removeAll.bind(V.root),Kn=V.root.get.bind(V.root),Yn=V.root.wait.bind(V.root),jn=V.root.loop.bind(V.root),Qn=V.root.tween.bind(V.root);function zn(e=2,t=1){let r=0;return{require:["scale"],update(){let n=Math.sin(r*e)*t;n<0&&this.destroy(),this.scale=O(n),r+=Ar()}}}k(zn,"boom");let Jn=re(null,"data:image/png;base64,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"),Xn=re(null,"data:image/png;base64,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");function Wn(e,t={}){let r=Gn([Yr(e),An()]),n=5*(t.speed||1),i=t.scale||1;r.add([sn(Xn),jr(0),Wr("center"),zn(n,i),...t.comps??[]]);let s=r.add([sn(Jn),jr(0),Wr("center"),cn(),...t.comps??[]]);return s.wait(.4/n,()=>s.use(zn(n,i))),s.onDestroy(()=>r.destroy()),r}function Zn(){V.root.update()}k(Wn,"addKaboom"),k(Zn,"updateFrame");const _n=class e{source;target;displacement;resolved=!1;constructor(e,t,r,n=!1){this.source=e,this.target=t,this.displacement=r,this.resolved=n}reverse(){return new e(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}};k(_n,"Collision");let $n=_n;function ei(){let t={},r=e.hashGridSize||64,n=new j,i=[];function s(e){if(i.push(n.clone()),e.pos&&n.translate(e.pos),e.scale&&n.scale(e.scale),e.angle&&n.rotate(e.angle),e.transform=n.clone(),e.c("area")&&!e.paused){let n=e,i=n.worldArea().bbox(),s=Math.floor(i.pos.x/r),o=Math.floor(i.pos.y/r),a=Math.ceil((i.pos.x+i.width)/r),h=Math.ceil((i.pos.y+i.height)/r),l=new Set;for(let e=s;e<=a;e++)for(let r=o;r<=h;r++)if(t[e])if(t[e][r]){let i=t[e][r];e:for(let e of i){if(e.paused||!e.exists()||l.has(e.id))continue;for(let r of n.collisionIgnore)if(e.is(r))continue e;for(let r of e.collisionIgnore)if(n.is(r))continue e;let t=me(n.worldArea(),e.worldArea());if(t){let r=new $n(n,e,t);n.trigger("collideUpdate",e,r);let i=r.reverse();i.resolved=r.resolved,e.trigger("collideUpdate",n,i)}l.add(e.id)}i.push(n)}else t[e][r]=[n];else t[e]={},t[e][r]=[n]}e.children.forEach(s),n=i.pop()}k(s,"checkObj"),s(V.root)}function ti(){let e=V.cam,t=L.fromAngle(Z(0,360)).scale(e.shake);e.shake=C(e.shake,0,5*Ar()),e.transform=(new j).translate(Fn()).scale(e.scale).rotate(e.angle).translate((e.pos??Fn()).scale(-1).add(t)),V.root.draw(),ct()}function ri(){let e=E();V.events.numListeners("loading")>0?V.events.trigger("loading",e):nr(()=>{let t=dr()/2,r=O(dr()/2,cr()/2).sub(O(t/2,12));Qt({pos:O(0),width:dr(),height:cr(),color:q(0,0,0)}),Qt({pos:r,width:t,height:24,fill:!1,outline:{width:4}}),Qt({pos:r,width:t*e,height:24})})}function ni(e,t){nr(()=>{let r=O(8);Gt(),Nt(e);let n=hr({text:t,font:xt,size:16,pos:r,color:q(255,255,255),fixed:!0}),i=n.width+2*r.x,s=n.height+2*r.x;e.x+i>=dr()&&Nt(O(-i,0)),e.y+s>=cr()&&Nt(O(0,-s)),Qt({width:i,height:s,color:q(0,0,0),radius:4,opacity:.8,fixed:!0}),ur(n),qt()})}function ii(){if(wr.inspect){let e=null;for(let t of V.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(V.root.drawInspect(),e){let t=[],r=e.inspect();for(let e in r)r[e]?t.push(`${e}: ${r[e]}`):t.push(`${e}`);ni(pr(gr()),t.join("\n"))}ni(O(8),`FPS: ${wr.fps()}`)}wr.paused&&nr(()=>{Gt(),Nt(dr(),0),Nt(-8,8);Qt({width:32,height:32,anchor:"topright",color:q(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Qt({width:4,height:19.2,anchor:"center",pos:O(-32/3*e,16),color:q(255,255,255),radius:2,fixed:!0});qt()}),1!==wr.timeScale&&nr(()=>{Gt(),Nt(dr(),cr()),Nt(-8,-8);let e=hr({text:wr.timeScale.toFixed(1),font:xt,size:16,color:q(255,255,255),pos:O(-8),anchor:"botright",fixed:!0});Qt({width:e.width+16+32,height:e.height+16,anchor:"botright",color:q(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let r=wr.timeScale<1;Xt({p1:O(-e.width-8*(r?2:3.5),-8),p2:O(-e.width-8*(r?2:3.5),-8-e.height),p3:O(-e.width-8*(r?3.5:2),-8-e.height/2),pos:O(8*-t*1+(r?-4:0),0),color:q(255,255,255),fixed:!0})}ur(e),qt()}),wr.curRecording&&nr(()=>{Gt(),Nt(0,cr()),Nt(24,-24),Wt({radius:12,color:q(255,0,0),opacity:Q(0,1,4*l.time()),fixed:!0}),qt()}),wr.showLog&&V.logs.length>0&&nr(()=>{Gt(),Nt(0,cr()),Nt(8,-8);let t=[];for(let e of V.logs){let r="",n=e.msg instanceof Error?"error":"info";r+=`[time]${e.time.toFixed(2)}[/time]`,r+=" ",r+=`[${n}]${e.msg?.toString?e.msg.toString():e.msg}[/${n}]`,t.push(r)}V.logs=V.logs.filter(t=>l.time()-t.time<(e.logTime||4));let r=hr({text:t.join("\n"),font:xt,pos:O(8,-8),anchor:"botleft",size:16,width:.6*dr(),lineSpacing:4,fixed:!0,styles:{time:{color:q(127,127,127)},info:{color:q(255,255,255)},error:{color:q(255,0,127)}}});Qt({width:r.width+16,height:r.height+16,anchor:"botleft",color:q(0,0,0),radius:4,opacity:.8,fixed:!0}),ur(r),qt()})}function si(e){V.events.on("loading",e)}function oi(e){l.onResize(e)}function ai(e){V.events.on("error",e)}function hi(e){console.error(e),A.ctx.suspend(),l.run(()=>{ft(),nr(()=>{let t=dr(),r=cr(),n={size:36,width:t-64,letterSpacing:4,lineSpacing:4,font:xt,fixed:!0};Qt({width:t,height:r,color:q(0,0,255),fixed:!0});let i=hr({...n,text:"Error",pos:O(32),color:q(255,128,0),fixed:!0});ur(i),lr({...n,text:e.message,pos:O(32,32+i.height+16),fixed:!0}),qt(),V.events.trigger("error",e)}),gt()})}function li(e){u.push(e)}function ui(){V.events.onOnce("frameEnd",()=>{l.quit(),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);let e=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)d.activeTexture(d.TEXTURE0+t),d.bindTexture(d.TEXTURE_2D,null),d.bindTexture(d.TEXTURE_CUBE_MAP,null);d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null),c.destroy(),u.forEach(e=>e())})}k(ei,"checkFrame"),k(ti,"drawFrame"),k(ri,"drawLoadScreen"),k(ni,"drawInspectText"),k(ii,"drawDebug"),k(si,"onLoading"),k(oi,"onResize"),k(ai,"onError"),k(hi,"handleErr"),k(li,"onCleanup"),k(ui,"quit");let di=!0;function ci(){let t=o,r=d.drawingBufferWidth/t,n=d.drawingBufferHeight/t;if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let t=r/n,i=e.width/e.height;if(t>i){let e=n*i,t=(r-e)/2;f.viewport={x:t,y:0,width:e,height:n}}else{let e=r/i,t=(n-e)/2;f.viewport={x:0,y:t,width:r,height:e}}return}if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");f.viewport={x:0,y:0,width:r,height:n}}function fi(){l.onHide(()=>{e.backgroundAudio||A.ctx.suspend()}),l.onShow(()=>{!e.backgroundAudio&&!wr.paused&&A.ctx.resume()}),l.onResize(()=>{if(l.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(r.width=r.offsetWidth*o,r.height=r.offsetHeight*o,ci(),t||(f.frameBuffer.free(),f.frameBuffer=new et(c,d.drawingBufferWidth,d.drawingBufferHeight),f.width=d.drawingBufferWidth/o,f.height=d.drawingBufferHeight/o))}),!1!==e.debug&&(l.onKeyPress("f1",()=>wr.inspect=!wr.inspect),l.onKeyPress("f2",()=>wr.clearLog()),l.onKeyPress("f8",()=>wr.paused=!wr.paused),l.onKeyPress("f7",()=>{wr.timeScale=Jr(D(wr.timeScale-.2,0,2),1)}),l.onKeyPress("f9",()=>{wr.timeScale=Jr(D(wr.timeScale+.2,0,2),1)}),l.onKeyPress("f10",()=>wr.stepFrame())),e.burp&&l.onKeyPress("b",()=>Xe())}l.run(()=>{try{y.loaded||1===E()&&!di&&(y.loaded=!0,V.events.trigger("load")),!y.loaded&&!1!==e.loadingScreen||di?(ft(),ri(),gt()):(wr.paused||Zn(),ei(),ft(),ti(),!1!==e.debug&&ii(),gt()),di&&(di=!1),V.events.trigger("frameEnd")}catch(t){hi(t)}}),k(ci,"updateViewport"),k(fi,"initEvents"),ci(),fi();let pi={VERSION:"3000.1.17",loadRoot:b,loadProgress:E,loadSprite:re,loadSpriteAtlas:z,loadSound:De,loadBitmapFont:P,loadFont:T,loadShader:Ve,loadShaderURL:xe,loadAseprite:pe,loadPedit:he,loadBean:Ue,loadJSON:S,load:x,getSprite:Ne,getSound:Le,getFont:Oe,getBitmapFont:Ge,getShader:qe,getAsset:He,Asset:st,SpriteData:g,SoundData:w,width:dr,height:cr,center:Fn,dt:Ar,time:l.time,screenshot:l.screenshot,record:Nn,isFocused:Ln,setCursor:l.setCursor,getCursor:l.getCursor,setCursorLocked:l.setCursorLocked,isCursorLocked:l.isCursorLocked,setFullscreen:l.setFullscreen,isFullscreen:l.isFullscreen,isTouchscreen:l.isTouchscreen,onLoad:Sn,onLoading:si,onResize:oi,onGamepadConnect:l.onGamepadConnect,onGamepadDisconnect:l.onGamepadDisconnect,onError:ai,onCleanup:li,camPos:yr,camScale:vr,camRot:Vr,shake:xr,toScreen:Er,toWorld:br,setGravity:Gr,getGravity:qr,setBackground:Hr,getBackground:Kr,getGamepads:l.getGamepads,add:Gn,make:Rr,destroy:On,destroyAll:Hn,get:Kn,readd:qn,pos:Yr,scale:jr,rotate:Qr,color:zr,opacity:Xr,anchor:Wr,area:rn,sprite:sn,text:on,polygon:an,rect:hn,circle:un,uvquad:ln,outline:dn,body:pn,doubleJump:gn,shader:mn,timer:cn,fixed:wn,stay:An,health:yn,lifespan:vn,z:Zr,move:$r,offscreen:en,follow:_r,state:Vn,fadeIn:xn,mask:En,drawon:bn,tile:Dn,agent:Un,on:Mr,onUpdate:Tr,onDraw:Pr,onAdd:kr,onDestroy:Br,onClick:Ur,onCollide:Fr,onCollideUpdate:Ir,onCollideEnd:Dr,onHover:Nr,onHoverUpdate:Lr,onHoverEnd:Or,onKeyDown:l.onKeyDown,onKeyPress:l.onKeyPress,onKeyPressRepeat:l.onKeyPressRepeat,onKeyRelease:l.onKeyRelease,onMouseDown:l.onMouseDown,onMousePress:l.onMousePress,onMouseRelease:l.onMouseRelease,onMouseMove:l.onMouseMove,onCharInput:l.onCharInput,onTouchStart:l.onTouchStart,onTouchMove:l.onTouchMove,onTouchEnd:l.onTouchEnd,onScroll:l.onScroll,onHide:l.onHide,onShow:l.onShow,onGamepadButtonDown:l.onGamepadButtonDown,onGamepadButtonPress:l.onGamepadButtonPress,onGamepadButtonRelease:l.onGamepadButtonRelease,onGamepadStick:l.onGamepadStick,mousePos:gr,mouseDeltaPos:l.mouseDeltaPos,isKeyDown:l.isKeyDown,isKeyPressed:l.isKeyPressed,isKeyPressedRepeat:l.isKeyPressedRepeat,isKeyReleased:l.isKeyReleased,isMouseDown:l.isMouseDown,isMousePressed:l.isMousePressed,isMouseReleased:l.isMouseReleased,isMouseMoved:l.isMouseMoved,isGamepadButtonPressed:l.isGamepadButtonPressed,isGamepadButtonDown:l.isGamepadButtonDown,isGamepadButtonReleased:l.isGamepadButtonReleased,getGamepadStick:l.getGamepadStick,charInputted:l.charInputted,loop:jn,wait:Yn,play:Je,volume:ze,burp:Xe,audioCtx:A.ctx,Line:de,Rect:ce,Circle:fe,Polygon:ge,Vec2:L,Color:G,Mat4:j,Quad:K,RNG:J,rand:Z,randi:_,randSeed:W,vec2:O,rgb:q,hsl2rgb:H,quad:Y,choose:ee,chance:$,lerp:C,tween:Qn,easings:wt,map:U,mapc:N,wave:Q,deg2rad:F,rad2deg:I,clamp:D,testLineLine:ne,testRectRect:te,testRectLine:ie,testRectPoint:se,testCirclePolygon:le,testLinePoint:oe,testLineCircle:ae,drawSprite:Yt,drawText:lr,formatText:hr,drawRect:Qt,drawLine:zt,drawLines:Jt,drawTriangle:Xt,drawCircle:Wt,drawEllipse:Zt,drawUVQuad:Ht,drawPolygon:_t,drawFormattedText:ur,drawMasked:er,drawSubtracted:tr,pushTransform:Gt,popTransform:qt,pushTranslate:Nt,pushScale:Lt,pushRotate:Ot,pushMatrix:Ut,usePostEffect:pt,makeCanvas:We,debug:wr,scene:Rn,go:Mn,onSceneLeave:Tn,addLevel:Cn,getData:Pn,setData:kn,download:be,downloadJSON:Re,downloadText:Se,downloadBlob:Me,plug:Bn,ASCII_CHARS:vt,canvas:l.canvas,addKaboom:Wn,LEFT:L.LEFT,RIGHT:L.RIGHT,UP:L.UP,DOWN:L.DOWN,RED:G.RED,GREEN:G.GREEN,BLUE:G.BLUE,YELLOW:G.YELLOW,MAGENTA:G.MAGENTA,CYAN:G.CYAN,WHITE:G.WHITE,BLACK:G.BLACK,quit:ui,Event:ye,EventHandler:ve,EventController:Ae};if(e.plugins&&e.plugins.forEach(Bn),!1!==e.global)for(let k in pi)window[k]=pi[k];return!1!==e.focus&&l.canvas.focus(),pi},"default")({global:!1,touchToMouse:!0,canvas:document.getElementById("game")});function Nt(e,t){const r=document.getElementById("textbox-container"),n=document.getElementById("dialogue");r.style.display="block";let i=0,s="";const o=setInterval(()=>{if(i<e.length)return s+=e[i],n.innerHTML=s,void i++;clearInterval(o)},1),a=document.getElementById("close");a.addEventListener("click",function e(){t(),r.style.display="none",n.innerHTML="",clearInterval(o),a.removeEventListener("click",e)}),addEventListener("keypress",e=>{"Enter"===e.code&&a.click()})}function Lt(e){e.width()/e.height()<1?e.camScale(e.vec2(1)):e.camScale(e.vec2(1.5))}Ut.loadSprite("spritesheet","./spritesheet.png",{sliceX:39,sliceY:31,anims:{"idle-down":952,"walk-down":{from:952,to:955,loop:!0,speed:8},"idle-side":991,"walk-side":{from:991,to:994,loop:!0,speed:8},"idle-up":1030,"walk-up":{from:1030,to:1033,loop:!0,speed:8}}}),Ut.loadSprite("map","./map.png"),Ut.setBackground(Ut.Color.fromHex("#222222")),Ut.scene("main",async()=>{const e=(await(await fetch("./map.json")).json()).layers,t=Ut.add([Ut.sprite("map"),Ut.pos(0),Ut.scale(M)]),r=Ut.make([Ut.sprite("spritesheet",{anim:"idle-down"}),Ut.area({shape:new Ut.Rect(Ut.vec2(0,3),10,10)}),Ut.body(),Ut.anchor("center"),Ut.pos(),Ut.scale(M),{speed:250,direction:"down",isInDialog:!1},"player"]);for(const s of e)if("boundaries"!==s.name){if("spawnpoint"===s.name)for(const e of s.objects)"player"!==e.name||(r.pos=Ut.vec2((t.pos.x+e.x)*M,(t.pos.y+e.y)*M),Ut.add(r))}else for(const e of s.objects)t.add([Ut.area({shape:new Ut.Rect(Ut.vec2(0),e.width,e.height)}),Ut.body({isStatic:!0}),Ut.pos(e.x,e.y),e.name]),e.name&&r.onCollide(e.name,()=>{r.isInDialogue=!0,Nt(T[e.name],()=>r.isInDialogue=!1)});function n(){const e=t.width*M,r=t.height*M;Ut.camPos(e/2,r/2-100)}function i(){"down"!==r.direction?"up"!==r.direction?r.play("idle-side"):r.play("idle-up"):r.play("idle-down")}Lt(Ut),Ut.onResize(()=>{Lt(Ut)}),window.innerWidth<700&&Ut.onUpdate(()=>{Ut.camPos(r.worldPos().x,r.worldPos().y-100)}),n(),Ut.onResize(()=>{Lt(Ut),n()}),Ut.onMouseDown(e=>{if("left"!==e||r.isInDialogue)return;const t=Ut.toWorld(Ut.mousePos());r.moveTo(t,r.speed);const n=r.pos.angle(t);return n>50&&n<125&&"walk-up"!==r.curAnim()?(r.play("walk-up"),void(r.direction="up")):n<-50&&n>-125&&"walk-down"!==r.curAnim()?(r.play("walk-down"),void(r.direction="down")):Math.abs(n)>125?(r.flipX=!1,"walk-side"!==r.curAnim()&&r.play("walk-side"),void(r.direction="right")):Math.abs(n)<50?(r.flipX=!0,"walk-side"!==r.curAnim()&&r.play("walk-side"),void(r.direction="left")):void 0}),Ut.onMouseRelease(i),Ut.onKeyRelease(()=>{i()}),Ut.onKeyDown(e=>{const t=[Ut.isKeyDown("right"),Ut.isKeyDown("left"),Ut.isKeyDown("up"),Ut.isKeyDown("down")];let n=0;for(const r of t)r&&n++;if(!(n>1||r.isInDialogue))return t[0]?(r.flipX=!1,"walk-side"!==r.curAnim()&&r.play("walk-side"),r.direction="right",void r.move(r.speed,0)):t[1]?(r.flipX=!0,"walk-side"!==r.curAnim()&&r.play("walk-side"),r.direction="left",void r.move(-r.speed,0)):t[2]?("walk-up"!==r.curAnim()&&r.play("walk-up"),r.direction="up",void r.move(0,-r.speed)):void(t[3]&&("walk-down"!==r.curAnim()&&r.play("walk-down"),r.direction="down",r.move(0,r.speed)))})}),Ut.go("main");
